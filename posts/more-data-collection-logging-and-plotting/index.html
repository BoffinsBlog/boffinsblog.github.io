<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>More Data Collection Logging and Plotting | Boffins Blog</title>
<meta name="keywords" content="Data Visualisation, gnuplot, Linux, Python, Raspberry Pi, Software, Web-Servers">
<meta name="description" content="Collecting data, logging to a csv file, plotting using gnuplot and sending to a web server.">
<meta name="author" content="Boffin">
<link rel="canonical" href="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e13be8719bbabf4005d0d2b0f19dba897f7d41b2e807b64c47ee1436d126ab01.css" integrity="sha256-4TvocZu6v0AF0NKw8Z26iX99QbLoB7ZMR&#43;4UNtEmqwE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://boffinsblog.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://boffinsblog.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://boffinsblog.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://boffinsblog.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://boffinsblog.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/">
  <meta property="og:site_name" content="Boffins Blog">
  <meta property="og:title" content="More Data Collection Logging and Plotting">
  <meta property="og:description" content="Collecting data, logging to a csv file, plotting using gnuplot and sending to a web server.">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-03-13T20:12:31+00:00">
    <meta property="article:modified_time" content="2020-03-13T20:12:31+00:00">
    <meta property="article:tag" content="Data Visualisation">
    <meta property="article:tag" content="Gnuplot">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="Software">
    <meta property="og:image" content="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/01_Temperature_Pressure_Graphs.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/01_Temperature_Pressure_Graphs.webp">
<meta name="twitter:title" content="More Data Collection Logging and Plotting">
<meta name="twitter:description" content="Collecting data, logging to a csv file, plotting using gnuplot and sending to a web server.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://boffinsblog.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "More Data Collection Logging and Plotting",
      "item": "https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "More Data Collection Logging and Plotting",
  "name": "More Data Collection Logging and Plotting",
  "description": "Collecting data, logging to a csv file, plotting using gnuplot and sending to a web server.",
  "keywords": [
    "Data Visualisation", "gnuplot", "Linux", "Python", "Raspberry Pi", "Software", "Web-Servers"
  ],
  "articleBody": "More plotting. As I mentioned in a previous post, I was interested in data collection using an environment sensor, logging that info to a csv file and plotting a graph using gnuplot.\nHowever, the incorrectly labelled graph axes annoyed me so I set about repairing them.\nAlso, I’m not going to revisit how it all sits together as that was done in the previous post .\nIn summary there is:\nA python file that collects data from the Enviro pHAT (i.e. the enviroplot.py)\nA .csv file that the python file writes comma separated values to (i.e. the enviroplot.csv)\nThe gnuplot script that interpret the .csv rows and produce the .png graphs\ntemp_pressure_last24hours.plot\ntemp_pressure_last7days.plot\ntemp_pressure_all.plot\nAn .sh file that wraps the python file and the gnuplot scripts together (i.e. enviroplot.sh)\nA cron job in the Pi then executes the .sh file every 15 minutes (i.e. the pi crontab)\nA cron job in the server then runs every 15 minutes to collect all the .png files (i.e. the server crontab)\nThe problem The main issue with the graph axes was the underlying data in the .csv file (unsurprisingly).\nI thought I was being clever and splitting out the date and time into separate columns, as it turns out that wasn’t so wise.\n(I thought that later analysis such as ‘shown me the average temperatures by hour over time’ might be easier if I split these columns beforehand.)\nThe Python code would need a rewrite anyway to address my error but what about the existing info?\nI had to choose from:\nThe quick way – abandon all the previously collected data and start afresh with the date and time captured correctly\nThe time consuming way – concatenate the existing columns into a format gnuplot could understand easier\nObviously I chose the time consuming way and fired up Excel.\n(I also took the opportunity to rewrite the plotting scripts as I had discovered that gnuplot was capable of creating dual axes graphs.)\nThe data collection bit The Python code that writes to the .csv file now looks like this:\nenviroplot.py #!/usr/bin/env python import csv from datetime import datetime from envirophat import weather dt = datetime.now() DateTime= dt.strftime('%d-%m-%Y %H:%M:%S') temp = round(weather.temperature(), 2) baro = round(weather.pressure(unit = 'hPa'), 2) csvWrite = DateTime, temp, baro csvFile = open('/home/foo/Dev/RasPi/enviroplot/enviroplot.csv', 'a') with csvFile: writer = csv.writer(csvFile) writer.writerow(csvWrite) The created .csv file now looks like this, with a single column for Date and Time:\nThe logging bit enviroplot.csv (Example of data collected) DateTime temp baro 23-01-2019 22:15:01 23.12 998.17 23-01-2019 22:30:01 22.89 998.35 23-01-2019 22:45:02 22.54 998.41 23-01-2019 23:00:02 22.2 998.44 23-01-2019 23:15:01 21.9 998.46 The plotting part The gnuplot script that creates a 640×480 dual axes graph in .png format of temperature and pressure over the last 24 hours.\ntemp_pressure_last24hours.plot # Create new plot reset unset key set key off set terminal png medium size 640,480 # csv DateTime format set datafile separator \",\" set timefmt \"%d-%m-%Y %H:%M:%S\" # Graph formatting set title \"Temperature and Pressure Over the Last 24 Hours\" # set grid # x axis formatting set xdata time set format x \"%l%p\" # y axis formatting set ytics 1 nomirror tc lt 1 set ylabel \"Temperature\" tc lt 1 # y2 axis formatting set y2tics 1 nomirror tc lt 2 set y2label \"Pressure\" tc lt 2 # Plot the data plot '\u003c tail -n 90 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:2 axes x1y1, '\u003c tail -n 90 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:3 axes x1y2 with lines The gnuplot script that creates a 640×480 dual axes graph in .png format of temperature and pressure over the last 7 days.\ntemp_pressure_last7days.plot # Create new plot reset unset key set key off set terminal png medium size 640,480 # csv DateTime format set datafile separator \",\" set timefmt \"%d-%m-%Y %H:%M:%S\" # Graph formatting set title \"Temperature and Pressure Over the Last 7 Days\" # set grid # x axis formatting set xdata time set format x \"%a\" # y axis formatting set ytics 1 nomirror tc lt 1 set ylabel \"Temperature\" tc lt 1 # y2 axis formatting set y2tics 5 nomirror tc lt 2 set y2label \"Pressure\" tc lt 2 # Plot the data plot '\u003c tail -n 672 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:2 axes x1y1, '\u003c tail -n 672 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:3 axes x1y2 with lines The gnuplot script that creates a 640×480 dual axes graph in .png format of temperature and pressure over all recorded data.\ntemp_pressure_all.plot # Create new plot reset unset key set key off set terminal png medium size 1280,480 # csv DateTime format set datafile separator \",\" set timefmt \"%d-%m-%Y %H:%M:%S\" # Graph formatting set title \"Temperature and Pressure Over All Time\" # set grid # x axis formatting set xdata time set format x \"%b %y\" # y axis formatting set ytics 10 nomirror tc lt 1 set ylabel \"Temperature\" tc lt 1 # y2 axis formatting set y2tics 10 nomirror tc lt 2 set y2label \"Pressure\" tc lt 2 # Plot the data plot '/home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:2 axes x1y1, '/home/foo/Dev/RasPi/enviroplot/enviroplot.csv' using 1:3 axes x1y2 with lines Automating using cron The .sh file to pull together the enviroplot.py and gnuplot scripts.\nenviroplot.sh #!/bin/sh # This is the script that the cron job will execute # Run the python script to collect the variables python /home/foo/Dev/RasPi/enviroplot/enviroplot.py #### Create the graph images from gnuplot # 'Sleep' is there to prevent a conflict sleep 10 gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_all.plot \u003e /home/foo/Dev/RasPi/enviroplot/temp_pressure_all.png sleep 10 gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_last7days.plot \u003e /home/foo/Dev/RasPi/enviroplot/temp_pressure_last7days.png sleep 10 gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_last24hours.plot \u003e /home/foo/Dev/RasPi/enviroplot/temp_pressure_last24hours.png The pi crontab that executes every 15 minutes to run enviroplot.sh.\npi crontab # This is the script that runs the bash script to collect data and create graphs */15 * * * * /home/foo/Dev/Raspi/enviroplot/enviroplot.sh The cron job on the server has changed slightly as it now pulls in all of the .png files and not the named ones as per the previous version.\nserver crontab # Collect the graphs from the 'piboard' machine */15 * * * * scp -i ~/.ssh/id_rsa_piboard foo@piboard:/home/foo/Dev/RasPi/enviroplot/*.png /var/www/html/ And finally! This is what the output looks like, snipped from a web page.\nNow that the visible range of data displayed has been shortened you can see that the temperature rises most evenings (when the heating comes on) and the following days weather can be predicted by looking at the pressure graphs.\nTemperature and Pressure Over the Last 24 Hours and Prior 7 Days\nAll of the Enviro pHAT code examples can also be found here .\n",
  "wordCount" : "1073",
  "inLanguage": "en",
  "image":"https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/01_Temperature_Pressure_Graphs.webp","datePublished": "2020-03-13T20:12:31Z",
  "dateModified": "2020-03-13T20:12:31Z",
  "author":{
    "@type": "Person",
    "name": "Boffin"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Boffins Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://boffinsblog.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://boffinsblog.github.io/" accesskey="h" title="Boffins Blog (Alt + H)">Boffins Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://boffinsblog.github.io/categories/featured/" title="Featured">
                    <span>Featured</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://boffinsblog.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://boffinsblog.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      More Data Collection Logging and Plotting
    </h1>
    <div class="post-meta"><span title='2020-03-13 20:12:31 +0000 GMT'>March 13, 2020</span>&nbsp;·&nbsp;<span>6 min</span>&nbsp;·&nbsp;<span>Boffin</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#more-plotting" aria-label="More plotting.">More plotting.</a></li>
                <li>
                    <a href="#the-problem" aria-label="The problem">The problem</a></li>
                <li>
                    <a href="#the-data-collection-bit" aria-label="The data collection bit">The data collection bit</a></li>
                <li>
                    <a href="#the-logging-bit" aria-label="The logging bit">The logging bit</a><ul>
                        
                <li>
                    <a href="#enviroplotcsv-example-of-data-collected" aria-label="enviroplot.csv (Example of data collected)">enviroplot.csv (Example of data collected)</a></li></ul>
                </li>
                <li>
                    <a href="#the-plotting-part" aria-label="The plotting part">The plotting part</a></li>
                <li>
                    <a href="#automating-using-cron" aria-label="Automating using cron">Automating using cron</a><ul>
                        
                <li>
                    <a href="#pi-crontab" aria-label="pi crontab">pi crontab</a></li>
                <li>
                    <a href="#server-crontab" aria-label="server crontab">server crontab</a></li></ul>
                </li>
                <li>
                    <a href="#and-finally" aria-label="And finally!">And finally!</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="more-plotting">More plotting.<a hidden class="anchor" aria-hidden="true" href="#more-plotting">#</a></h2>
<p>As I mentioned in a previous post, I was interested in data collection using an environment sensor, logging that info to a csv file and plotting a graph using gnuplot.</p>
<p>However, the incorrectly labelled graph axes annoyed me so I set about repairing them.</p>
<p>Also, I’m not going to revisit how it all sits together as 


  <a href="/posts/data-collection-logging-and-plotting/">that was done in the previous post</a>
.</p>
<p>In summary there is:</p>
<ul>
<li>
<p>A python file that collects data from the Enviro pHAT (i.e. the <strong>enviroplot.py</strong>)</p>
</li>
<li>
<p>A <strong>.csv</strong> file that the python file writes comma separated values to (i.e. the <strong>enviroplot.csv</strong>)</p>
</li>
<li>
<p>The gnuplot script that interpret the .<strong>csv</strong> rows and produce the <strong>.png</strong> graphs</p>
<ul>
<li>
<p><strong>temp_pressure_last24hours.plot</strong></p>
</li>
<li>
<p><strong>temp_pressure_last7days.plot</strong></p>
</li>
<li>
<p><strong>temp_pressure_all.plot</strong></p>
</li>
</ul>
</li>
<li>
<p>An <strong>.sh</strong> file that wraps the python file and the gnuplot scripts together (i.e. <strong>enviroplot.sh</strong>)</p>
</li>
<li>
<p>A <strong>cron</strong> job in the Pi then executes the <strong>.sh</strong> file every 15 minutes (i.e. the <strong>pi crontab</strong>)</p>
</li>
<li>
<p>A <strong>cron</strong> job in the server then runs every 15 minutes to collect all the <strong>.png</strong> files (i.e. the <strong>server crontab</strong>)</p>
</li>
</ul>
<h2 id="the-problem">The problem<a hidden class="anchor" aria-hidden="true" href="#the-problem">#</a></h2>
<p>The main issue with the graph axes was the underlying data in the <strong>.csv</strong> file (unsurprisingly).</p>
<p>I thought I was being clever and splitting out the date and time into separate columns, as it turns out that wasn’t so wise.</p>
<p>(I thought that later analysis such as <em>‘shown me the average temperatures by hour over time’</em> might be easier if I split these columns beforehand.)</p>
<p>The Python code would need a rewrite anyway to address my error but what about the existing info?</p>
<p>I had to choose from:</p>
<ul>
<li>
<p>The quick way – abandon all the previously collected data and start afresh with the date and time captured correctly</p>
</li>
<li>
<p>The time consuming way – concatenate the existing columns into a format gnuplot could understand easier</p>
</li>
</ul>
<p>Obviously I chose the time consuming way and fired up Excel.</p>
<p>(I also took the opportunity to rewrite the plotting scripts as I had discovered that gnuplot was capable of creating dual axes graphs.)</p>
<h2 id="the-data-collection-bit">The data collection bit<a hidden class="anchor" aria-hidden="true" href="#the-data-collection-bit">#</a></h2>
<p>The Python code that writes to the <strong>.csv</strong> file now looks like this:</p>
<h3 id="enviroplotpy">

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/blob/main/enviroplot/enviroplot.py" target="_blank" rel="nofollow noopener noreferrer">enviroplot.py</a>
</h3>
<pre tabindex="0"><code>#!/usr/bin/env python

import csv
from datetime import datetime
from envirophat import weather

dt = datetime.now()
DateTime= dt.strftime(&#39;%d-%m-%Y %H:%M:%S&#39;)
temp = round(weather.temperature(), 2)
baro = round(weather.pressure(unit = &#39;hPa&#39;), 2)

csvWrite = DateTime, temp, baro
csvFile = open(&#39;/home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39;, &#39;a&#39;)

with csvFile:
        writer = csv.writer(csvFile)
        writer.writerow(csvWrite)
</code></pre><p>The created .csv file now looks like this, with a single column for Date and Time:</p>
<h2 id="the-logging-bit">The logging bit<a hidden class="anchor" aria-hidden="true" href="#the-logging-bit">#</a></h2>
<h3 id="enviroplotcsv-example-of-data-collected">enviroplot.csv (Example of data collected)<a hidden class="anchor" aria-hidden="true" href="#enviroplotcsv-example-of-data-collected">#</a></h3>
<pre tabindex="0"><code>DateTime temp baro
23-01-2019 22:15:01 23.12 998.17
23-01-2019 22:30:01 22.89 998.35
23-01-2019 22:45:02 22.54 998.41
23-01-2019 23:00:02 22.2 998.44
23-01-2019 23:15:01 21.9 998.46
</code></pre><h2 id="the-plotting-part">The plotting part<a hidden class="anchor" aria-hidden="true" href="#the-plotting-part">#</a></h2>
<p>The gnuplot script that creates a 640×480 dual axes graph in <strong>.png</strong> format of temperature and pressure over the last 24 hours.</p>
<h3 id="temp_">

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/blob/main/enviroplot/temp_pressure_last24hours.plot" target="_blank" rel="nofollow noopener noreferrer">temp_pressure_last24hours.plot</a>
</h3>
<pre tabindex="0"><code># Create new plot
reset
unset key 
set key off 
set terminal png medium size 640,480

# csv DateTime format
set datafile separator &#34;,&#34;
set timefmt &#34;%d-%m-%Y %H:%M:%S&#34;

# Graph formatting
set title &#34;Temperature and Pressure Over the Last 24 Hours&#34;
# set grid

# x axis formatting
set xdata time
set format x &#34;%l%p&#34;

# y axis formatting
set ytics 1 nomirror tc lt 1
set ylabel &#34;Temperature&#34; tc lt 1

# y2 axis formatting
set y2tics 1 nomirror tc lt 2
set y2label &#34;Pressure&#34; tc lt 2

# Plot the data
plot &#39;&lt; tail -n 90 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:2 axes x1y1, &#39;&lt; tail -n 90 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:3 axes x1y2 with lines
</code></pre><p>The gnuplot script that creates a 640×480 dual axes graph in <strong>.png</strong> format of temperature and pressure over the last 7 days.</p>
<h3 id="temp_-1">

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/blob/main/enviroplot/temp_pressure_last7days.plot" target="_blank" rel="nofollow noopener noreferrer">temp_pressure_last7days.plot</a>
</h3>
<pre tabindex="0"><code># Create new plot
reset
unset key 
set key off 
set terminal png medium size 640,480

# csv DateTime format
set datafile separator &#34;,&#34;
set timefmt &#34;%d-%m-%Y %H:%M:%S&#34;

# Graph formatting
set title &#34;Temperature and Pressure Over the Last 7 Days&#34;
# set grid

# x axis formatting
set xdata time
set format x &#34;%a&#34;

# y axis formatting
set ytics 1 nomirror tc lt 1
set ylabel &#34;Temperature&#34; tc lt 1

# y2 axis formatting
set y2tics 5 nomirror tc lt 2
set y2label &#34;Pressure&#34; tc lt 2

# Plot the data
plot &#39;&lt; tail -n 672 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:2 axes x1y1, &#39;&lt; tail -n 672 /home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:3 axes x1y2 with lines
</code></pre><p>The gnuplot script that creates a 640×480 dual axes graph in <strong>.png</strong> format of temperature and pressure over all recorded data.</p>
<h3 id="temp_-2">

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/blob/main/enviroplot/temp_pressure_all.plot" target="_blank" rel="nofollow noopener noreferrer">temp_pressure_all.plot</a>
</h3>
<pre tabindex="0"><code># Create new plot
reset
unset key 
set key off 
set terminal png medium size 1280,480

# csv DateTime format
set datafile separator &#34;,&#34;
set timefmt &#34;%d-%m-%Y %H:%M:%S&#34;

# Graph formatting
set title &#34;Temperature and Pressure Over All Time&#34;
# set grid

# x axis formatting
set xdata time
set format x &#34;%b %y&#34;

# y axis formatting
set ytics 10 nomirror tc lt 1
set ylabel &#34;Temperature&#34; tc lt 1

# y2 axis formatting
set y2tics 10 nomirror tc lt 2
set y2label &#34;Pressure&#34; tc lt 2

# Plot the data
plot &#39;/home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:2 axes x1y1, &#39;/home/foo/Dev/RasPi/enviroplot/enviroplot.csv&#39; using 1:3 axes x1y2 with lines
</code></pre><h2 id="automating-using-cron">Automating using cron<a hidden class="anchor" aria-hidden="true" href="#automating-using-cron">#</a></h2>
<p>The <strong>.sh</strong> file to pull together the <strong>enviroplot.py</strong> and gnuplot scripts.</p>
<h3 id="enviroplotsh">

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/blob/main/enviroplot/enviroplot.sh" target="_blank" rel="nofollow noopener noreferrer">enviroplot.sh</a>
</h3>
<pre tabindex="0"><code>#!/bin/sh
# This is the script that the cron job will execute

# Run the python script to collect the variables
python /home/foo/Dev/RasPi/enviroplot/enviroplot.py

#### Create the graph images from gnuplot
# &#39;Sleep&#39; is there to prevent a conflict
sleep 10
gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_all.plot &gt; /home/foo/Dev/RasPi/enviroplot/temp_pressure_all.png
sleep 10
gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_last7days.plot &gt; /home/foo/Dev/RasPi/enviroplot/temp_pressure_last7days.png
sleep 10
gnuplot /home/foo/Dev/RasPi/enviroplot/temp_pressure_last24hours.plot &gt; /home/foo/Dev/RasPi/enviroplot/temp_pressure_last24hours.png
</code></pre><p>The pi crontab that executes every 15 minutes to run <strong>enviroplot.sh</strong>.</p>
<h3 id="pi-crontab">pi crontab<a hidden class="anchor" aria-hidden="true" href="#pi-crontab">#</a></h3>
<pre tabindex="0"><code># This is the script that runs the bash script to collect data and create graphs
*/15 * * * * /home/foo/Dev/Raspi/enviroplot/enviroplot.sh
</code></pre><p>The <strong>cron</strong> job on the server has changed slightly as it now pulls in <strong>all</strong> of the <strong>.png</strong> files and not the named ones as per the previous version.</p>
<h3 id="server-crontab">server crontab<a hidden class="anchor" aria-hidden="true" href="#server-crontab">#</a></h3>
<pre tabindex="0"><code># Collect the graphs from the &#39;piboard&#39; machine
*/15 * * * * scp -i ~/.ssh/id_rsa_piboard foo@piboard:/home/foo/Dev/RasPi/enviroplot/*.png /var/www/html/
</code></pre><h2 id="and-finally">And finally!<a hidden class="anchor" aria-hidden="true" href="#and-finally">#</a></h2>
<p>This is what the output looks like, snipped from a web page.</p>
<p>Now that the visible range of data displayed has been shortened you can see that the temperature rises most evenings (when the heating comes on) and the following days weather can be predicted by looking at the pressure graphs.</p>
<p><img alt="Data collection using an enviroment sensor, logging to a csv file and plotting a graph using gnuplot. Screen-grab of two graphs side by side showing the temperature and pressure. The left hand graph shows temperature and pressure over the last 24 hours, while the right hand one shows temperature and pressure over the prior 7 days." loading="lazy" src="/posts/more-data-collection-logging-and-plotting/02_Temperature_Pressure_Graphs.webp#center" title="Data collection using an enviroment sensor, logging to a csv file and plotting a graph using gnuplot. Screen-grab of two graphs side by side showing the temperature and pressure. The left hand graph shows temperature and pressure over the last 24 hours, while the right hand one shows temperature and pressure over the prior 7 days.">
<em>Temperature and Pressure Over the Last 24 Hours and Prior 7 Days</em></p>
<p>All of the Enviro pHAT code examples can also be found 

<a href="https://github.com/BoffinsBlog/Enviro-pHAT/" target="_blank" rel="nofollow noopener noreferrer">here</a>
.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://boffinsblog.github.io/tags/data-visualisation/">Data Visualisation</a></li>
      <li><a href="https://boffinsblog.github.io/tags/gnuplot/">Gnuplot</a></li>
      <li><a href="https://boffinsblog.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://boffinsblog.github.io/tags/python/">Python</a></li>
      <li><a href="https://boffinsblog.github.io/tags/raspberry-pi/">Raspberry Pi</a></li>
      <li><a href="https://boffinsblog.github.io/tags/software/">Software</a></li>
      <li><a href="https://boffinsblog.github.io/tags/web-servers/">Web-Servers</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://boffinsblog.github.io/posts/robot-pan-tilt-hat-cctv/">
    <span class="title">« Prev</span>
    <br>
    <span>Robot Pan / Tilt Hat CCTV</span>
  </a>
  <a class="next" href="https://boffinsblog.github.io/posts/oled-bus-timetable/">
    <span class="title">Next »</span>
    <br>
    <span>OLED Bus Timetable</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://boffinsblog.github.io/">Boffins Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <br>
        <p><a href="https://www.creativecommons.org/licenses/by-nc/4.0/deed.en" rel="noopener noreferrer" target="_blank">This work is licensed under CC BY-NC-SA 4.0</a></p>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
