<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>OLED Bus Timetable | Boffins Blog</title>
<meta name="keywords" content="Hardware, Maker, Python, Raspberry Pi, Software">
<meta name="description" content="Show the bus timetable on an OLED display!">
<meta name="author" content="Boffin">
<link rel="canonical" href="https://boffinsblog.github.io/posts/oled-bus-timetable/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e13be8719bbabf4005d0d2b0f19dba897f7d41b2e807b64c47ee1436d126ab01.css" integrity="sha256-4TvocZu6v0AF0NKw8Z26iX99QbLoB7ZMR&#43;4UNtEmqwE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://boffinsblog.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://boffinsblog.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://boffinsblog.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://boffinsblog.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://boffinsblog.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://boffinsblog.github.io/posts/oled-bus-timetable/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://boffinsblog.github.io/posts/oled-bus-timetable/">
  <meta property="og:site_name" content="Boffins Blog">
  <meta property="og:title" content="OLED Bus Timetable">
  <meta property="og:description" content="Show the bus timetable on an OLED display!">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-04-14T21:39:55+00:00">
    <meta property="article:modified_time" content="2019-04-14T21:39:55+00:00">
    <meta property="article:tag" content="Hardware">
    <meta property="article:tag" content="Maker">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="Software">
    <meta property="og:image" content="https://boffinsblog.github.io/posts/oled-bus-timetable/01_Tiny_OLED_Bus_Timetable.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://boffinsblog.github.io/posts/oled-bus-timetable/01_Tiny_OLED_Bus_Timetable.webp">
<meta name="twitter:title" content="OLED Bus Timetable">
<meta name="twitter:description" content="Show the bus timetable on an OLED display!">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://boffinsblog.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "OLED Bus Timetable",
      "item": "https://boffinsblog.github.io/posts/oled-bus-timetable/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OLED Bus Timetable",
  "name": "OLED Bus Timetable",
  "description": "Show the bus timetable on an OLED display!",
  "keywords": [
    "Hardware", "Maker", "Python", "Raspberry Pi", "Software"
  ],
  "articleBody": "Stop missing the bus! Show the timetable on an OLED display!\nI put together a Raspberry Pi and a tiny OLED display to show a bus timetable, showing the departure time of the next bus at my local stop; All built from a ‘Beautiful Soup’ web scrape and not using an API.\nOLED Bus Timetable Overview Not exactly a massive project but a fun introduction for me to the Pimoroni 1.2″ Mono OLED .\nInspired by this post , I thought I’d put that little OLED to some use and see if I could:\nScrape a website to determine when the next bus to town is departing\nThen write this info to the OLED\nThen keep on refreshing\nThe Scripts 22_next.py Shows the amount of time before the next departure from this bus stop.\n#!/usr/bin/env python3 # General import os import time # For the scraping from bs4 import BeautifulSoup import requests # For the oled from PIL import Image from PIL import ImageFont from PIL import ImageDraw from threading import Thread from luma.core.interface.serial import i2c from luma.core.render import canvas from luma.oled.device import sh1106 # Set up OLED oled = sh1106(i2c(port=1, address=0x3C), rotate=2, height=128, width=128) # Load fonts rr_path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'fonts', 'Roboto_Regular.ttf')) rb_path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'fonts', 'Roboto_Black.ttf')) rr_12 = ImageFont.truetype(rr_path, 12) rr_24 = ImageFont.truetype(rr_path, 24) # The main loop that writes to the OLED while True: # Page url to scrape url ='https://www.buses.co.uk/stops/149000006645' # Fetch the content from url page = requests.get(url, timeout=5) # Parse html soup = BeautifulSoup(page.content, \"html.parser\") # Extract the html element where the next time expected is stored time_expected = soup.find(class_='single-visit__time--expected') # Strip extraneous html next_bus = time_expected.text.strip() # Start to draw to the display background = Image.open(\"/home/foo/Dev/Raspi/busses/images/bus.png\").convert(oled.mode) draw = ImageDraw.ImageDraw(background) # Draw the top line draw.rectangle([(0, 0), (128, 20)], fill=\"black\") draw.line([(0, 20), (128, 20)], fill=\"white\") # Draw the text draw.rectangle([(0, 108), (128, 128)], fill=\"black\") draw.text((10, 40), \"The next bus is in\", fill=\"white\", font=rr_12) draw.text((20, 60), next_bus, fill=\"white\", font=rr_24) # Draw the bottom line draw.rectangle([(0, 108), (128, 128)], fill=\"black\") draw.line([(0, 108), (128, 108)], fill=\"white\") # Display on the OLED oled.display(background) time.sleep(0.05) 22_deps.py Shows the upcoming departures from this bus stop.\n#!/usr/bin/env python3 # General import os import time # For the scraping from bs4 import BeautifulSoup import requests # For the oled from PIL import Image from PIL import ImageFont from PIL import ImageDraw from threading import Thread from luma.core.interface.serial import i2c from luma.core.render import canvas from luma.oled.device import sh1106 # Set up OLED oled = sh1106(i2c(port=1, address=0x3C), rotate=2, height=128, width=128) # Load fonts rr_path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'fonts', 'Roboto_Regular.ttf')) rb_path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'fonts', 'Roboto_Black.ttf')) rr_12 = ImageFont.truetype(rr_path, 12) rr_24 = ImageFont.truetype(rr_path, 24) # The main loop that writes to the OLED while True: # Page url to scrape url ='https://www.buses.co.uk/stops/149000006645' # Fetch the content from url page = requests.get(url, timeout=5) # Parse html soup = BeautifulSoup(page.content, \"html.parser\") # Extract the html element where the next times expected are stored for bus_times in soup.findAll('div', attrs={\"class\":\"single-visit__time single-visit__time--expected\"}): bus_deps = bus_times.text.strip() # Start to draw to the display background = Image.open(\"/home/foo/Dev/Raspi/busses/images/bus.png\").convert(oled.mode) draw = ImageDraw.ImageDraw(background) # Draw the top line draw.rectangle([(0, 0), (128, 20)], fill=\"black\") draw.line([(0, 20), (128, 20)], fill=\"white\") # Draw the text draw.rectangle([(0, 108), (128, 128)], fill=\"black\") draw.text((10, 40), \"The next bus is in\", fill=\"white\", font=rr_12) draw.text((20, 60), bus_deps, fill=\"white\", font=rr_24) # Draw the bottom line draw.rectangle([(0, 108), (128, 128)], fill=\"black\") draw.line([(0, 108), (128, 108)], fill=\"white\") # Display on the OLED oled.display(background) time.sleep(0.05) continue Well, it works, so now I don’t have to keep looking at the bus app on my phone in a morning…\nOLED Display Showing the Next Bus Departure\nHope this helps someone looking for a simple way to write basic text to the display.\n(It doesn’t have to be a bus timetable that can be written to the OLED display, maybe tide tables or how long until the bin men arrive?)\nAll of the Mono OLED code examples can also be found here .\n",
  "wordCount" : "651",
  "inLanguage": "en",
  "image":"https://boffinsblog.github.io/posts/oled-bus-timetable/01_Tiny_OLED_Bus_Timetable.webp","datePublished": "2019-04-14T21:39:55Z",
  "dateModified": "2019-04-14T21:39:55Z",
  "author":{
    "@type": "Person",
    "name": "Boffin"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://boffinsblog.github.io/posts/oled-bus-timetable/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Boffins Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://boffinsblog.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://boffinsblog.github.io/" accesskey="h" title="Boffins Blog (Alt + H)">Boffins Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://boffinsblog.github.io/categories/featured/" title="Featured">
                    <span>Featured</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://boffinsblog.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://boffinsblog.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      OLED Bus Timetable
    </h1>
    <div class="post-meta"><span title='2019-04-14 21:39:55 +0000 +0000'>April 14, 2019</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>Boffin</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#stop-missing-the-bus" aria-label="Stop missing the bus!">Stop missing the bus!</a></li>
                <li>
                    <a href="#oled-bus-timetable-overview" aria-label="OLED Bus Timetable Overview">OLED Bus Timetable Overview</a></li>
                <li>
                    <a href="#the-scripts" aria-label="The Scripts">The Scripts</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="stop-missing-the-bus">Stop missing the bus!<a hidden class="anchor" aria-hidden="true" href="#stop-missing-the-bus">#</a></h2>
<p>Show the timetable on an OLED display!</p>
<p>I put together a Raspberry Pi and a tiny OLED display to show a bus timetable, showing the departure time of the next bus at my local stop; All built from a ‘Beautiful Soup’ web scrape and not using an API.</p>
<h2 id="oled-bus-timetable-overview">OLED Bus Timetable Overview<a hidden class="anchor" aria-hidden="true" href="#oled-bus-timetable-overview">#</a></h2>
<p>Not exactly a massive project but a fun introduction for me to the 

<a href="https://shop.pimoroni.com/products/1-12-oled-breakout" target="_blank" rel="nofollow noopener noreferrer">Pimoroni 1.2″ Mono OLED</a>
.</p>
<p>Inspired 

<a href="https://forums.pimoroni.com/t/writing-to-inkyphat/10119" target="_blank" rel="nofollow noopener noreferrer">by this post</a>
, I thought I’d put that little OLED to some use and see if I could:</p>
<ul>
<li>
<p>Scrape a website to determine when the next bus to town is departing</p>
</li>
<li>
<p>Then write this info to the OLED</p>
</li>
<li>
<p>Then keep on refreshing</p>
</li>
</ul>
<h2 id="the-scripts">The Scripts<a hidden class="anchor" aria-hidden="true" href="#the-scripts">#</a></h2>
<h3 id="22_">

<a href="https://github.com/BoffinsBlog/Mono-OLED/blob/main/busses/22_next.py" target="_blank" rel="nofollow noopener noreferrer">22_next.py</a>
</h3>
<p>Shows the amount of time before the next departure from this bus stop.</p>
<pre tabindex="0"><code>#!/usr/bin/env python3

# General
import os
import time

# For the scraping
from bs4 import BeautifulSoup
import requests

# For the oled
from PIL import Image
from PIL import ImageFont
from PIL import ImageDraw
from threading import Thread
from luma.core.interface.serial import i2c
from luma.core.render import canvas
from luma.oled.device import sh1106

# Set up OLED
oled = sh1106(i2c(port=1, address=0x3C), rotate=2, height=128, width=128)

# Load fonts
rr_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#39;fonts&#39;, &#39;Roboto_Regular.ttf&#39;))
rb_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#39;fonts&#39;, &#39;Roboto_Black.ttf&#39;))
rr_12 = ImageFont.truetype(rr_path, 12)
rr_24 = ImageFont.truetype(rr_path, 24)

# The main loop that writes to the OLED
while True:
	# Page url to scrape
	url =&#39;https://www.buses.co.uk/stops/149000006645&#39;

	# Fetch the content from url
	page = requests.get(url, timeout=5)

	# Parse html
	soup = BeautifulSoup(page.content, &#34;html.parser&#34;)

	# Extract the html element where the next time expected is stored
	time_expected = soup.find(class_=&#39;single-visit__time--expected&#39;)

	# Strip extraneous html
	next_bus = time_expected.text.strip()

	# Start to draw to the display
	background = Image.open(&#34;/home/foo/Dev/Raspi/busses/images/bus.png&#34;).convert(oled.mode)
	draw = ImageDraw.ImageDraw(background)

	# Draw the top line
	draw.rectangle([(0, 0), (128, 20)], fill=&#34;black&#34;)
	draw.line([(0, 20), (128, 20)], fill=&#34;white&#34;)

	# Draw the text
	draw.rectangle([(0, 108), (128, 128)], fill=&#34;black&#34;)
	draw.text((10, 40), &#34;The next bus is in&#34;, fill=&#34;white&#34;, font=rr_12)
	draw.text((20, 60), next_bus, fill=&#34;white&#34;, font=rr_24)

	# Draw the bottom line
	draw.rectangle([(0, 108), (128, 128)], fill=&#34;black&#34;)
	draw.line([(0, 108), (128, 108)], fill=&#34;white&#34;)

	# Display on the OLED
	oled.display(background)
	time.sleep(0.05)
</code></pre><h3 id="22_-1">

<a href="https://github.com/BoffinsBlog/Mono-OLED/blob/main/busses/22_deps.py" target="_blank" rel="nofollow noopener noreferrer">22_deps.py</a>
</h3>
<p>Shows the upcoming departures from this bus stop.</p>
<pre tabindex="0"><code>#!/usr/bin/env python3

# General
import os
import time

# For the scraping
from bs4 import BeautifulSoup
import requests

# For the oled
from PIL import Image
from PIL import ImageFont
from PIL import ImageDraw
from threading import Thread
from luma.core.interface.serial import i2c
from luma.core.render import canvas
from luma.oled.device import sh1106

# Set up OLED
oled = sh1106(i2c(port=1, address=0x3C), rotate=2, height=128, width=128)

# Load fonts
rr_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#39;fonts&#39;, &#39;Roboto_Regular.ttf&#39;))
rb_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#39;fonts&#39;, &#39;Roboto_Black.ttf&#39;))
rr_12 = ImageFont.truetype(rr_path, 12)
rr_24 = ImageFont.truetype(rr_path, 24)

# The main loop that writes to the OLED
while True:
    # Page url to scrape
    url =&#39;https://www.buses.co.uk/stops/149000006645&#39;

    # Fetch the content from url
    page = requests.get(url, timeout=5)

    # Parse html
    soup = BeautifulSoup(page.content, &#34;html.parser&#34;)

    # Extract the html element where the next times expected are stored
    for bus_times in soup.findAll(&#39;div&#39;, attrs={&#34;class&#34;:&#34;single-visit__time single-visit__time--expected&#34;}):
            bus_deps = bus_times.text.strip()

    # Start to draw to the display
    background = Image.open(&#34;/home/foo/Dev/Raspi/busses/images/bus.png&#34;).convert(oled.mode)
    draw = ImageDraw.ImageDraw(background)

    # Draw the top line
    draw.rectangle([(0, 0), (128, 20)], fill=&#34;black&#34;)
    draw.line([(0, 20), (128, 20)], fill=&#34;white&#34;)

    # Draw the text
    draw.rectangle([(0, 108), (128, 128)], fill=&#34;black&#34;)
    draw.text((10, 40), &#34;The next bus is in&#34;, fill=&#34;white&#34;, font=rr_12)
    draw.text((20, 60), bus_deps, fill=&#34;white&#34;, font=rr_24)

    # Draw the bottom line
    draw.rectangle([(0, 108), (128, 128)], fill=&#34;black&#34;)
    draw.line([(0, 108), (128, 108)], fill=&#34;white&#34;)

    # Display on the OLED
    oled.display(background)
    time.sleep(0.05)

    continue
</code></pre><p>Well, it works, so now I don’t have to keep looking at the bus app on my phone in a morning…</p>
<p><img alt="A tiny OLED display showing how long before the next bus is due to arrive." loading="lazy" src="/posts/oled-bus-timetable/01_Tiny_OLED_Bus_Timetable.webp#center" title="A tiny OLED display showing how long before the next bus is due to arrive.">
<em>OLED Display Showing the Next Bus Departure</em></p>
<p>Hope this helps someone looking for a simple way to write basic text to the display.</p>
<p>(It doesn’t have to be a bus timetable that can be written to the OLED display, maybe tide tables or how long until the bin men arrive?)</p>
<p>All of the Mono OLED code examples can also be found 

<a href="https://github.com/BoffinsBlog/Mono-OLED/" target="_blank" rel="nofollow noopener noreferrer">here</a>
.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://boffinsblog.github.io/tags/hardware/">Hardware</a></li>
      <li><a href="https://boffinsblog.github.io/tags/maker/">Maker</a></li>
      <li><a href="https://boffinsblog.github.io/tags/python/">Python</a></li>
      <li><a href="https://boffinsblog.github.io/tags/raspberry-pi/">Raspberry Pi</a></li>
      <li><a href="https://boffinsblog.github.io/tags/software/">Software</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://boffinsblog.github.io/posts/more-data-collection-logging-and-plotting/">
    <span class="title">« Prev</span>
    <br>
    <span>More Data Collection Logging and Plotting</span>
  </a>
  <a class="next" href="https://boffinsblog.github.io/posts/data-collection-logging-and-plotting/">
    <span class="title">Next »</span>
    <br>
    <span>Data Collection, Logging and Plotting</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://boffinsblog.github.io/">Boffins Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <br>
        <p><a href="https://www.creativecommons.org/licenses/by-nc/4.0/deed.en" rel="noopener noreferrer" target="_blank">This work is licensed under CC BY-NC-SA 4.0</a></p>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
