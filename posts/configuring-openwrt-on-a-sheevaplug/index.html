<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Configuring OpenWrt on a SheevaPlug | Boffins Blog</title>
<meta name="keywords" content="Hardware, Linux, OpenWrt, Self Hosting, SheevaPlug, Software">
<meta name="description" content="Configuring OpenWrt on a SheevaPlug.">
<meta name="author" content="Boffin">
<link rel="canonical" href="https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e13be8719bbabf4005d0d2b0f19dba897f7d41b2e807b64c47ee1436d126ab01.css" integrity="sha256-4TvocZu6v0AF0NKw8Z26iX99QbLoB7ZMR&#43;4UNtEmqwE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://boffinsblog.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://boffinsblog.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://boffinsblog.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://boffinsblog.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://boffinsblog.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/">
  <meta property="og:site_name" content="Boffins Blog">
  <meta property="og:title" content="Configuring OpenWrt on a SheevaPlug">
  <meta property="og:description" content="Configuring OpenWrt on a SheevaPlug.">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-29T15:18:52+01:00">
    <meta property="article:modified_time" content="2025-08-29T15:18:52+01:00">
    <meta property="article:tag" content="Hardware">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="OpenWrt">
    <meta property="article:tag" content="Self Hosting">
    <meta property="article:tag" content="SheevaPlug">
    <meta property="article:tag" content="Software">
    <meta property="og:image" content="https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/01_Configuring_OpenWrt_Static_IP_Address.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/01_Configuring_OpenWrt_Static_IP_Address.webp">
<meta name="twitter:title" content="Configuring OpenWrt on a SheevaPlug">
<meta name="twitter:description" content="Configuring OpenWrt on a SheevaPlug.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://boffinsblog.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Configuring OpenWrt on a SheevaPlug",
      "item": "https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Configuring OpenWrt on a SheevaPlug",
  "name": "Configuring OpenWrt on a SheevaPlug",
  "description": "Configuring OpenWrt on a SheevaPlug.",
  "keywords": [
    "Hardware", "Linux", "OpenWrt", "Self Hosting", "SheevaPlug", "Software"
  ],
  "articleBody": "Introduction A short series of SheevaPlug posts around the installation and configuration of different Operating Systems and additional software.\nUnbricking and booting\nUnbricking Installing Das U-Boot Using OpenWrt\nInstalling OpenWrt on the NAND Configuring OpenWrt Using Debian\nInstalling Debian Bookworm on an MMC Upgrading Debian Bookworm to Trixie Additional OpenWrt software\nInstalling a lighttpd web server Configuring lighttpd TLS and ACME Files and Tools Needed These are some basic configuration steps; setting a hostname, a fixed IP and creating a hardened login using SSH keys.\nAssumptions: The ‘Plug boots and is wired to the network.\nSteps Find the SheevaPlug IP on the network, I ‘ Nmap ‘:\nsudo nmap -sn /24\nNmap scan report for Host is up (0.0016s latency). MAC Address: 00:50:43:01:63:EA (Marvell Semiconductor) Login via SSH ssh root@\nChange the password passwd\nUpdate the firmware cd /tmp\nDownload:\nwget https://downloads.openwrt.org/releases/24.10.2/targets/kirkwood/generic/openwrt-24.10.2-kirkwood-generic-globalscale_sheevaplug-squashfs-sysupgrade.bin\nInstall:\nsysupgrade openwrt-24.10.2-kirkwood-generic-globalscale_sheevaplug-squashfs-sysupgrade.bin\nThe ‘Plug will reboot after the update.\nUpdate existing packages OpenWrt uses the opkg package management system.\nOpkg is a full package manager for the root file system, including kernel modules and drivers\nhttps://openwrt.org/docs/guide-user/additional-software/opkg Run the following in a Terminal to update:\nopkg update\nThen, update all of the installed packages:\nopkg list-upgradable | cut -f 1 -d ' ' | xargs -r opkg upgrade\nNote: It’s also possible to update everything from the LuCI web interface (http://) but as there is a connection open and available I choose to update here.\nInstall a few extra packages These are pretty much the packages that I use all the time:\nbtop for viewing running processes mc or Midnight Commander for a visual file manager nano for editing text files openssh-sftp-server for connecting to the SheevaPlug and mounting the device rsync for receiving files on the SheevaPlug Run the following in a Terminal to update:\nopkg update\nThen, install the packages:\nopkg install btop\nopkg install mc\nopkg install nano\nopkg install openssh-sftp-server\nopkg install rsync\nSet the hostname Run the following in a Terminal to edit the config file:\nnano /etc/config/system\nChange:\noption hostname 'OpenWrt'\nTo:\noption hostname 'sheevaplug'\nThen restart:\nreboot\nSet a fixed IP Run the following in a Terminal to edit the config file:\nnano /etc/config/network\nChange where needed / appropriate for your network:\nconfig interface 'lan' option device 'br-lan' option proto 'static' option ipaddr '' option netmask '' option gateway '' option broadcast '' list dns '' Restart networking:\n/etc/init.d/network restart\nCheck using:\nifconfig\nInstall the packages needed to create new users https://openwrt.org/docs/guide-user/additional-software/create-new-users This is to be able to add a non-root user foo who can su.\nRun the following in a Terminal to update:\nopkg update\nThen, install the packages:\nopkg install shadow-useradd shadow-su\nCreate a new foo user useradd -m -s /bin/ash foo\nSet the new user password passwd foo\nExit the root account The following ssh steps need to be executed as the newly created foo user, so exit the root account.\nsu foo\ncd\nAdd the SSH Keys https://openwrt.org/docs/guide-user/security/dropbear.public-key.auth Firstly, make a .ssh dir for foo:\nmkdir -m700 /home/foo/.ssh\nAdd the key SHEEVAPLUG_SSH_KEY.pub:\nnano /home/foo/.ssh/authorized_keys\nSet the authorized_keys permissions:\nchmod 600 /home/foo/.ssh/authorized_keys\nRestart the SSH service su\nservice log restart; service dropbear restart\nTest that you can connect to the ‘Plug from another machine ssh -o PasswordAuthentication=no sheevaplug\nAnd:\nssh -o PasswordAuthentication=no -o PubkeyAcceptedKeyTypes=ssh-rsa sheevaplug\nShould connect to the ‘Plug.\nHarden security Disable password authentication uci set dropbear.@dropbear[0].PasswordAuth=\"0\"\nDisable logging in with root privileges uci set dropbear.@dropbear[0].RootPasswordAuth=\"0\"\nCommit the changes uci commit dropbear\nThen, restart service dropbear restart\nTest SSH Security Logging in as a normal user:\nssh foo@\nShould fail with a message like this:\nfoo@: Permission denied (publickey).\nLogging in as a root user:\nssh root@\nShould fail with a message like this:\nroot@: Permission denied (publickey).\nHowever, logging in using the SSH key should work:\nssh sheevaplug\nUser foo can then su with a password.\nTweak the new user profile I’m not a fan of vim as the editor so I change the default to nano.\nhttps://openwrt.org/docs/guide-user/base-system/user.beginner.cli#profile_customization su\nnano /etc/profile\n# Added by me # Change the default editor export EDITOR=\"nano\" # Set the LOCALE (btop complains if this is not set) export LC_CTYPE=en_GB.UTF-8 Conclusion The ‘Plug now has a working, up-to-date, OpenWrt installation with a hostname, a fixed IP and a non-root login using SSH keys.\nTime to install a web server .\n",
  "wordCount" : "720",
  "inLanguage": "en",
  "image":"https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/01_Configuring_OpenWrt_Static_IP_Address.webp","datePublished": "2025-08-29T15:18:52+01:00",
  "dateModified": "2025-08-29T15:18:52+01:00",
  "author":{
    "@type": "Person",
    "name": "Boffin"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://boffinsblog.github.io/posts/configuring-openwrt-on-a-sheevaplug/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Boffins Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://boffinsblog.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://boffinsblog.github.io/" accesskey="h" title="Boffins Blog (Alt + H)">Boffins Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://boffinsblog.github.io/categories/featured/" title="Featured">
                    <span>Featured</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://boffinsblog.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://boffinsblog.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Configuring OpenWrt on a SheevaPlug
    </h1>
    <div class="post-meta"><span title='2025-08-29 15:18:52 +0100 BST'>August 29, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>Boffin</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#files-and-tools-needed" aria-label="Files and Tools Needed">Files and Tools Needed</a></li>
                <li>
                    <a href="#steps" aria-label="Steps">Steps</a><ul>
                        
                <li>
                    <a href="#login-via-ssh" aria-label="Login via SSH">Login via SSH</a><ul>
                        
                <li>
                    <a href="#change-the-password" aria-label="Change the password">Change the password</a></li>
                <li>
                    <a href="#update-the-firmware" aria-label="Update the firmware">Update the firmware</a></li>
                <li>
                    <a href="#update-existing-packages" aria-label="Update existing packages">Update existing packages</a></li>
                <li>
                    <a href="#install-a-few-extra-packages" aria-label="Install a few extra packages">Install a few extra packages</a></li>
                <li>
                    <a href="#set-the-hostname" aria-label="Set the hostname">Set the hostname</a></li>
                <li>
                    <a href="#set-a-fixed-ip" aria-label="Set a fixed IP">Set a fixed IP</a></li>
                <li>
                    <a href="#install-the-packages-needed-to-create-new-users" aria-label="Install the packages needed to create new users">Install the packages needed to create new users</a><ul>
                        
                <li>
                    <a href="#create-a-new-foo-user" aria-label="Create a new foo user">Create a new foo user</a></li>
                <li>
                    <a href="#set-the-new-user-password" aria-label="Set the new user password">Set the new user password</a></li>
                <li>
                    <a href="#exit-the-root-account" aria-label="Exit the root account">Exit the root account</a></li>
                <li>
                    <a href="#add-the-ssh-keys" aria-label="Add the SSH Keys">Add the SSH Keys</a></li></ul>
                </li>
                <li>
                    <a href="#restart-the-ssh-service" aria-label="Restart the SSH service">Restart the SSH service</a></li></ul>
                </li>
                <li>
                    <a href="#test-that-you-can-connect-to-the-plug-from-another-machine" aria-label="Test that you can connect to the ‘Plug from another machine">Test that you can connect to the ‘Plug from another machine</a></li>
                <li>
                    <a href="#harden-security" aria-label="Harden security">Harden security</a><ul>
                        
                <li>
                    <a href="#disable-password-authentication" aria-label="Disable password authentication">Disable password authentication</a></li>
                <li>
                    <a href="#disable-logging-in-with-root-privileges" aria-label="Disable logging in with root privileges">Disable logging in with root privileges</a></li>
                <li>
                    <a href="#commit-the-changes" aria-label="Commit the changes">Commit the changes</a></li>
                <li>
                    <a href="#then-restart" aria-label="Then, restart">Then, restart</a></li></ul>
                </li>
                <li>
                    <a href="#test-ssh-security" aria-label="Test SSH Security">Test SSH Security</a><ul>
                        <ul>
                        
                <li>
                    <a href="#tweak-the-new-user-profile" aria-label="Tweak the new user profile">Tweak the new user profile</a></li></ul>
                    </ul>
                </li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>A short series of SheevaPlug posts around the installation and configuration of different Operating Systems and additional software.</p>
<p><strong>Unbricking and booting</strong></p>
<ul>
<li>
<p>


  <a href="/posts/unbricking-a-sheevaplug">Unbricking</a>
</p>
</li>
<li>
<p>


  <a href="/posts/installing-das-u-boot-on-a-sheevaplug-nand">Installing Das U-Boot</a>
</p>
</li>
</ul>
<p><strong>Using OpenWrt</strong></p>
<ul>
<li>
<p>


  <a href="/posts/installing-openwrt-on-a-sheevaplug-nand">Installing OpenWrt on the NAND</a>
</p>
</li>
<li>
<p>


  <a href="/posts/configuring-openwrt-on-a-sheevaplug">Configuring OpenWrt</a>
</p>
</li>
</ul>
<p><strong>Using Debian</strong></p>
<ul>
<li>
<p>


  <a href="/posts/installing-debian-bookworm-on-a-sheevaplug-mmc">Installing Debian Bookworm on an MMC</a>
</p>
</li>
<li>
<p>


  <a href="/posts/upgrading-debian-bookworm-to-trixie-on-a-sheevaplug-mmc">Upgrading Debian Bookworm to Trixie</a>
</p>
</li>
</ul>
<p><strong>Additional OpenWrt software</strong></p>
<ul>
<li>
<p>


  <a href="/posts/installing-lighttpd-on-a-sheevaplug-running-openwrt">Installing a lighttpd web server</a>
</p>
</li>
<li>
<p>


  <a href="/posts/configuring-lighttpd-tls-and-acme-on-a-sheevaplug">Configuring lighttpd TLS and ACME</a>
</p>
</li>
</ul>
<h2 id="files-and-tools-needed">Files and Tools Needed<a hidden class="anchor" aria-hidden="true" href="#files-and-tools-needed">#</a></h2>
<p>These are some basic configuration steps; setting a hostname, a fixed IP and creating a hardened login using SSH keys.</p>
<p>Assumptions: The &lsquo;Plug boots and is wired to the network.</p>
<h2 id="steps">Steps<a hidden class="anchor" aria-hidden="true" href="#steps">#</a></h2>
<p>Find the SheevaPlug IP on the network, I  ‘

<a href="https://nmap.org/" target="_blank" rel="nofollow noopener noreferrer">Nmap</a>
‘:</p>
<p><code>sudo nmap -sn &lt;ROUTER_IP&gt;/24</code></p>
<pre tabindex="0"><code>Nmap scan report for &lt;SHEEVAPLUG_IP&gt;
Host is up (0.0016s latency).
MAC Address: 00:50:43:01:63:EA (Marvell Semiconductor)
</code></pre><h3 id="login-via-ssh">Login via SSH<a hidden class="anchor" aria-hidden="true" href="#login-via-ssh">#</a></h3>
<p><code>ssh root@&lt;SHEEVAPLUG_IP&gt;</code></p>
<h4 id="change-the-password">Change the password<a hidden class="anchor" aria-hidden="true" href="#change-the-password">#</a></h4>
<p><code>passwd</code></p>
<h4 id="update-the-firmware">Update the firmware<a hidden class="anchor" aria-hidden="true" href="#update-the-firmware">#</a></h4>
<p><code>cd /tmp</code></p>
<p>Download:</p>
<p><code>wget https://downloads.openwrt.org/releases/24.10.2/targets/kirkwood/generic/openwrt-24.10.2-kirkwood-generic-globalscale_sheevaplug-squashfs-sysupgrade.bin</code></p>
<p>Install:</p>
<p><code>sysupgrade openwrt-24.10.2-kirkwood-generic-globalscale_sheevaplug-squashfs-sysupgrade.bin</code></p>
<p>The &lsquo;Plug will reboot after the update.</p>
<h4 id="update-existing-packages">Update existing packages<a hidden class="anchor" aria-hidden="true" href="#update-existing-packages">#</a></h4>
<p>OpenWrt uses the opkg package management system.</p>
<blockquote>
<p>Opkg is a full package manager for the root file system, including kernel modules and drivers</p>
<p>

<a href="https://openwrt.org/docs/guide-user/additional-software/opkg" target="_blank" rel="nofollow noopener noreferrer">https://openwrt.org/docs/guide-user/additional-software/opkg</a>
</p></blockquote>
<p>Run the following in a Terminal to update:</p>
<p><code>opkg update</code></p>
<p>Then, update all of the installed packages:</p>
<p><code>opkg list-upgradable | cut -f 1 -d ' ' | xargs -r opkg upgrade</code></p>
<p>Note: It&rsquo;s also possible to update everything from the LuCI web interface (http://&lt;SHEEVAPLUG_IP&gt;) but as there is a connection open and available I choose to update here.</p>
<h4 id="install-a-few-extra-packages">Install a few extra packages<a hidden class="anchor" aria-hidden="true" href="#install-a-few-extra-packages">#</a></h4>
<p>These are pretty much the packages that I use all the time:</p>
<ul>
<li><strong>btop</strong> for viewing running processes</li>
<li><strong>mc</strong> or Midnight Commander for a visual file manager</li>
<li><strong>nano</strong> for editing text files</li>
<li><strong>openssh-sftp-server</strong> for connecting <em>to</em> the SheevaPlug and mounting the device</li>
<li><strong>rsync</strong> for receiving files <em>on</em> the SheevaPlug</li>
</ul>
<p>Run the following in a Terminal to update:</p>
<p><code>opkg update</code></p>
<p>Then, install the packages:</p>
<p><code>opkg install btop</code></p>
<p><code>opkg install mc</code></p>
<p><code>opkg install nano</code></p>
<p><code>opkg install openssh-sftp-server</code></p>
<p><code>opkg install rsync</code></p>
<h4 id="set-the-hostname">Set the hostname<a hidden class="anchor" aria-hidden="true" href="#set-the-hostname">#</a></h4>
<p>Run the following in a Terminal to edit the config file:</p>
<p><code>nano /etc/config/system</code></p>
<p>Change:</p>
<p><code>option hostname 'OpenWrt'</code></p>
<p>To:</p>
<p><code>option hostname 'sheevaplug'</code></p>
<p>Then restart:</p>
<p><code>reboot</code></p>
<h4 id="set-a-fixed-ip">Set a fixed IP<a hidden class="anchor" aria-hidden="true" href="#set-a-fixed-ip">#</a></h4>
<p>Run the following in a Terminal to edit the config file:</p>
<p><code>nano /etc/config/network</code></p>
<p>Change where needed / appropriate for your network:</p>
<pre tabindex="0"><code>config interface &#39;lan&#39;
    option device &#39;br-lan&#39;
    option proto &#39;static&#39;
    option ipaddr &#39;&lt;SheevaPlug_IP&gt;&#39;
    option netmask &#39;&lt;Netmask_IP&gt;&#39;
    option gateway &#39;&lt;Gateway_IP&gt;&#39;
    option broadcast &#39;&lt;Broadcast_IP&gt;&#39;
    list dns &#39;&lt;DNS_IP&gt;&#39;
</code></pre><p>Restart networking:</p>
<p><code>/etc/init.d/network restart</code></p>
<p>Check using:</p>
<p><code>ifconfig</code></p>
<h4 id="install-the-packages-needed-to-create-new-users">Install the packages needed to create new users<a hidden class="anchor" aria-hidden="true" href="#install-the-packages-needed-to-create-new-users">#</a></h4>
<p>

<a href="https://openwrt.org/docs/guide-user/additional-software/create-new-users" target="_blank" rel="nofollow noopener noreferrer">https://openwrt.org/docs/guide-user/additional-software/create-new-users</a>
</p>
<p>This is to be able to add a non-root user <code>foo</code> who can <code>su</code>.</p>
<p>Run the following in a Terminal to update:</p>
<p><code>opkg update</code></p>
<p>Then, install the packages:</p>
<p><code>opkg install shadow-useradd shadow-su</code></p>
<h5 id="create-a-new-foo-user">Create a new foo user<a hidden class="anchor" aria-hidden="true" href="#create-a-new-foo-user">#</a></h5>
<p><code>useradd -m -s /bin/ash foo</code></p>
<h5 id="set-the-new-user-password">Set the new user password<a hidden class="anchor" aria-hidden="true" href="#set-the-new-user-password">#</a></h5>
<p><code>passwd foo</code></p>
<h5 id="exit-the-root-account">Exit the root account<a hidden class="anchor" aria-hidden="true" href="#exit-the-root-account">#</a></h5>
<p>The following ssh steps need to be executed as the newly created foo user, so exit the root account.</p>
<p><code>su foo</code></p>
<p><code>cd</code></p>
<h5 id="add-the-ssh-keys">Add the SSH Keys<a hidden class="anchor" aria-hidden="true" href="#add-the-ssh-keys">#</a></h5>
<p>

<a href="https://openwrt.org/docs/guide-user/security/dropbear.public-key.auth" target="_blank" rel="nofollow noopener noreferrer">https://openwrt.org/docs/guide-user/security/dropbear.public-key.auth</a>
</p>
<p>Firstly, make a <strong>.ssh</strong> dir for <strong>foo</strong>:</p>
<p><code>mkdir -m700 /home/foo/.ssh</code></p>
<p>Add the key <strong>SHEEVAPLUG_SSH_KEY.pub</strong>:</p>
<p><code>nano /home/foo/.ssh/authorized_keys</code></p>
<p>Set the <strong>authorized_keys</strong> permissions:</p>
<p><code>chmod 600 /home/foo/.ssh/authorized_keys</code></p>
<h4 id="restart-the-ssh-service">Restart the SSH service<a hidden class="anchor" aria-hidden="true" href="#restart-the-ssh-service">#</a></h4>
<p><code>su</code></p>
<p><code>service log restart; service dropbear restart</code></p>
<h3 id="test-that-you-can-connect-to-the-plug-from-another-machine">Test that you can connect to the ‘Plug from another machine<a hidden class="anchor" aria-hidden="true" href="#test-that-you-can-connect-to-the-plug-from-another-machine">#</a></h3>
<p><code>ssh -o PasswordAuthentication=no sheevaplug</code></p>
<p>And:</p>
<p><code>ssh -o PasswordAuthentication=no -o PubkeyAcceptedKeyTypes=ssh-rsa sheevaplug</code></p>
<p>Should connect to the &lsquo;Plug.</p>
<h3 id="harden-security">Harden security<a hidden class="anchor" aria-hidden="true" href="#harden-security">#</a></h3>
<h4 id="disable-password-authentication">Disable password authentication<a hidden class="anchor" aria-hidden="true" href="#disable-password-authentication">#</a></h4>
<p><code>uci set dropbear.@dropbear[0].PasswordAuth=&quot;0&quot;</code></p>
<h4 id="disable-logging-in-with-root-privileges">Disable logging in with root privileges<a hidden class="anchor" aria-hidden="true" href="#disable-logging-in-with-root-privileges">#</a></h4>
<p><code>uci set dropbear.@dropbear[0].RootPasswordAuth=&quot;0&quot;</code></p>
<h4 id="commit-the-changes">Commit the changes<a hidden class="anchor" aria-hidden="true" href="#commit-the-changes">#</a></h4>
<p><code>uci commit dropbear</code></p>
<h4 id="then-restart">Then, restart<a hidden class="anchor" aria-hidden="true" href="#then-restart">#</a></h4>
<p><code>service dropbear restart</code></p>
<h3 id="test-ssh-security">Test SSH Security<a hidden class="anchor" aria-hidden="true" href="#test-ssh-security">#</a></h3>
<p>Logging in as a normal user:</p>
<p><code>ssh foo@&lt;SheevaPlug_IP&gt;</code></p>
<p>Should fail with a message like this:</p>
<p><strong>foo@&lt;SheevaPlug_IP&gt;: Permission denied (publickey).</strong></p>
<p>Logging in as a root user:</p>
<p><code>ssh root@&lt;SheevaPlug_IP&gt;</code></p>
<p>Should fail with a message like this:</p>
<p><strong>root@&lt;SheevaPlug_IP&gt;: Permission denied (publickey).</strong></p>
<p>However, logging in using the SSH key should work:</p>
<p><code>ssh sheevaplug</code></p>
<p>User <strong>foo</strong> can then <strong>su</strong> with a password.</p>
<h5 id="tweak-the-new-user-profile">Tweak the new user profile<a hidden class="anchor" aria-hidden="true" href="#tweak-the-new-user-profile">#</a></h5>
<p>I&rsquo;m not a fan of vim as the editor so I change the default to nano.</p>
<p>

<a href="https://openwrt.org/docs/guide-user/base-system/user.beginner.cli#profile_customization" target="_blank" rel="nofollow noopener noreferrer">https://openwrt.org/docs/guide-user/base-system/user.beginner.cli#profile_customization</a>
</p>
<p><code>su</code></p>
<p><code>nano /etc/profile</code></p>
<pre tabindex="0"><code># Added by me

# Change the default editor
export EDITOR=&#34;nano&#34;

# Set the LOCALE (btop complains if this is not set)
export LC_CTYPE=en_GB.UTF-8
</code></pre><h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>The &lsquo;Plug now has a working, up-to-date, OpenWrt installation with a hostname, a fixed IP and a non-root login using SSH keys.</p>
<p>Time to install a 


  <a href="/posts/installing-lighttpd-on-a-sheevaplug-running-openwrt">web server</a>
.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://boffinsblog.github.io/tags/hardware/">Hardware</a></li>
      <li><a href="https://boffinsblog.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://boffinsblog.github.io/tags/openwrt/">OpenWrt</a></li>
      <li><a href="https://boffinsblog.github.io/tags/self-hosting/">Self Hosting</a></li>
      <li><a href="https://boffinsblog.github.io/tags/sheevaplug/">SheevaPlug</a></li>
      <li><a href="https://boffinsblog.github.io/tags/software/">Software</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://boffinsblog.github.io/posts/installing-debian-bookworm-on-a-sheevaplug-mmc/">
    <span class="title">« Prev</span>
    <br>
    <span>Installing Debian Bookworm on a SheevaPlug MMC</span>
  </a>
  <a class="next" href="https://boffinsblog.github.io/posts/installing-openwrt-on-a-sheevaplug-nand/">
    <span class="title">Next »</span>
    <br>
    <span>Installing OpenWrt on a SheevaPlug NAND</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://boffinsblog.github.io/">Boffins Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <br>
        <p><a href="https://www.creativecommons.org/licenses/by-nc/4.0/deed.en" rel="noopener noreferrer" target="_blank">This work is licensed under CC BY-NC-SA 4.0</a></p>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
