<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Moving to GoToSocial | Boffins Blog</title>
<meta name="keywords" content="Fediverse, Linux, Raspberry Pi, Self Hosting, Web-Servers">
<meta name="description" content="Because I like fixing things until they break, I decided to move my Socials to a different Fediverse software.">
<meta name="author" content="Boffin">
<link rel="canonical" href="https://boffinsblog.github.io/posts/moving-to-gotosocial/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e13be8719bbabf4005d0d2b0f19dba897f7d41b2e807b64c47ee1436d126ab01.css" integrity="sha256-4TvocZu6v0AF0NKw8Z26iX99QbLoB7ZMR&#43;4UNtEmqwE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://boffinsblog.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://boffinsblog.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://boffinsblog.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://boffinsblog.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://boffinsblog.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://boffinsblog.github.io/posts/moving-to-gotosocial/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://boffinsblog.github.io/posts/moving-to-gotosocial/">
  <meta property="og:site_name" content="Boffins Blog">
  <meta property="og:title" content="Moving to GoToSocial">
  <meta property="og:description" content="Because I like fixing things until they break, I decided to move my Socials to a different Fediverse software.">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-02T19:21:23+01:00">
    <meta property="article:modified_time" content="2025-01-02T19:21:23+01:00">
    <meta property="article:tag" content="Fediverse">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="Self Hosting">
    <meta property="article:tag" content="Web-Servers">
    <meta property="og:image" content="https://boffinsblog.github.io/posts/moving-to-gotosocial/01_Boffin_Settings_Screen.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://boffinsblog.github.io/posts/moving-to-gotosocial/01_Boffin_Settings_Screen.webp">
<meta name="twitter:title" content="Moving to GoToSocial">
<meta name="twitter:description" content="Because I like fixing things until they break, I decided to move my Socials to a different Fediverse software.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://boffinsblog.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Moving to GoToSocial",
      "item": "https://boffinsblog.github.io/posts/moving-to-gotosocial/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Moving to GoToSocial",
  "name": "Moving to GoToSocial",
  "description": "Because I like fixing things until they break, I decided to move my Socials to a different Fediverse software.",
  "keywords": [
    "Fediverse", "Linux", "Raspberry Pi", "Self Hosting", "Web-Servers"
  ],
  "articleBody": "Why? It’s more a question of ‘Why Not?’.\nI was perfectly happy with Iceshrimp.NET but wanted to try something new.\nGtS seemed lighter and has hooks into Grafana and Prometheus so I’d be able to mess around with Metrics.\nResources https://docs.gotosocial.org/en/latest/getting_started/ https://docs.gotosocial.org/en/latest/getting_started/installation/ https://docs.gotosocial.org/en/latest/getting_started/installation/metal/ Preparatory Stuff Create a PostgreSQL GtS database In a Terminal, do the following as normal user:\nsudo -u postgres psql\nThen, (line by line):\nCREATE DATABASE gotosocial_database WITH LOCALE 'C.UTF-8' TEMPLATE template0;\nCREATE USER gotosocial_user WITH PASSWORD 'super_long_password';\nGRANT ALL PRIVILEGES ON DATABASE gotosocial_database TO gotosocial_user;\nALTER DATABASE gotosocial_database OWNER TO gotosocial_user;\nDatabase Notes: To list all the databases:\n\\l\nTo quit:\n\\q\nTo DROP a database (in case something gets bungled):\nDROP DATABASE \"gotosocial_database\";\nTo DROP a User (in case something gets bungled):\nDROP USER \"gotosocial_user\";\nnginx Configuration In a Terminal, do the following as normal user to create the .conf file:\nsudo nano /etc/nginx/sites-available/GtS\nThen add (changing as appropriate):\nserver { listen 80; # No need for an ipv6 address # listen [::]:80; server_name gts.example.com; location / { # set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758 proxy_pass http://127.0.0.1:8888; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; } client_max_body_size 40M; } Check:\nsudo nginx -t\nSymlink:\nsudo ln -s /etc/nginx/sites-available/GtS /etc/nginx/sites-enabled/\nCheck and reload the webserver:\nsudo nginx -t \u0026\u0026 sudo systemctl reload nginx\nUFW I use UFW to limit which services can connect to the server.\nTo authorise traffic on Port 8888, first see a verbose list of currently configured connections:\nsudo ufw status verbose\nThen, allow GtS on Port 8888:\nsudo ufw allow 8888 comment \"GtS (GoToSocial) Traffic\"\nTo delete first see a list of currently configured connections:\nsudo ufw status numbered\nThen, delete the appropriate number:\nsudo ufw delete #\nCertbot Certbot is a free, open source software tool for automatically using Let’s Encrypt certificates on manually-administrated websites to enable HTTPS.\nCertbot is made by the Electronic Frontier Foundation (EFF), a 501(c)3 nonprofit based in San Francisco, CA, that defends digital privacy, free speech, and innovation.\nhttps://certbot.eff.org/pages/about If needed Certbot is a Terminal command away:\nsudo apt install certbot python3-certbot-nginx\nThen, to generate a certificate:\nsudo certbot\nAfter cert has been deployed, re-edit the nginx .conf file:\nsudo nano /etc/nginx/sites-available/GtS\nTo:\nserver { # HTTPS configuration listen 443 ssl; # Server server_name gts.example.com; # SSL ssl_certificate /etc/letsencrypt/live/gts.example.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/gts.example.com/privkey.pem; ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # logging access_log /var/log/nginx/gts.example.com_access.log combined buffer=512k flush=1m; error_log /var/log/nginx/gts.example.com_error.log warn; # security include nginxconfig.io/security.conf; include /etc/letsencrypt/options-ssl-nginx.conf; client_max_body_size 40M; # Proxy to Node location / { proxy_pass http://127.0.0.1:8888; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; } } # HTTP redirect server { if ($host = gts.example.com) { return 301 https://$host$request_uri; } listen 80; server_name gts.example.com; return 404; } Check and reload the webserver:\nsudo nginx -t \u0026\u0026 sudo systemctl reload nginx\nInstall Now that there is a database to store the info in, and a running webserver, it’s finally time to install GtS.\nCreate a directory:\nmkdir gotosocial\nMove to the newly created directory:\ncd gotosocial\nMake a ‘storage’ directory:\nmkdir storage\nGrab the latest GtS bundle:\nwget https://github.com/superseriousbusiness/gotosocial/releases/download/v0.17.1/gotosocial_0.17.1_linux_arm64.tar.gz\nUnzip everything:\ntar -xzf gotosocial_0.17.1_linux_arm64.tar.gz\nTidy up:\nrm gotosocial_0.17.1_linux_arm64.tar.gz\nConfigure Copy the example config file before making any changes:\ncp example/config.yaml config.yaml\nOpen it:\nnano config.yaml\nI made the following adjustments (the descriptors are self-explanatory):\n#host: \"localhost\" host: \"gts.example.com\" #account-domain: \"\" account-domain: \"example.com\" #bind-address: \"0.0.0.0\" bind-address: \"localhost\" #Port 8080 is already in use by something else, so change it to something else #port: 8080 port: 8888 #db-address: \"\" db-address: \"localhost\" #db-user: \"\" db-user: \"gotosocial_user\" #db-password: \"\" db-password: \"super_long_password\" #db-database: \"gotosocial\" db-database: \"gotosocial_database\" #media-remote-cache-days: 7 media-remote-cache-days: 1 #media-cleanup-every: \"24h\" media-cleanup-every: \"8h\" Start, Create Account(s) The moment of truth!\nStart the GtS server:\n./gotosocial --config-path ./config.yaml server start\nCreate the first user(s).\nhttps://docs.gotosocial.org/en/latest/getting_started/user_creation/ Personally, I have two accounts:\nAn Admin account A general non privileged (normal) account YMMV.\nAdd an account:\ncd ~/gotosocial\n./gotosocial --config-path ~/gotosocial/config.yaml \\ admin account create \\ --username admin_account \\ --email admin_account@example.com \\ --password 'admin_account_password' Promote to Admin:\n./gotosocial admin account promote --username admin_account --config-path config.yaml\nAdd another account:\n./gotosocial --config-path ~/gotosocial/config.yaml \\ admin account create \\ --username general_account \\ --email general_account@example.com \\ --password 'general_account_password' Do not promote to Admin.\nEnable the systemd service Create the systemd service that will start when the server reboots.\nhttps://codeberg.org/superseriousbusiness/gotosocial/src/branch/main/example/gotosocial.service sudo nano /etc/systemd/system/gotosocial.service\nRun:\nsudo systemctl enable --now gotosocial.service\nsudo systemctl start gotosocial.service\nCheck the service status:\nsudo systemctl status gotosocial.service\nAuthentication with the API (get a TOKEN) I have a couple of bots that need to post autonomously using the API.\nThis functionality needs an an Auth token:\nhttps://docs.gotosocial.org/en/latest/api/authentication/ Landing Page (config.yaml) As this is a self-hosted single user instance, rather than the generic GtS homepage I would like my Account Profile to be displayed.\nnano gotosocial/config.yaml\n#landing-page-user: \"\" landing-page-user: \"general_account\" sudo systemctl restart gotosocial\nMetrics https://docs.gotosocial.org/en/latest/advanced/metrics/ I’m a big fan of Metrics and Dashboards , so of course I’m going to enable this feature:\nEdit the config.yaml file.\nI made the following adjustments (the descriptors are self-explanatory):\nnano gotosocial/config.yaml\n#metrics-enabled: false metrics-enabled: true #metrics-auth-enabled: false metrics-auth-enabled: true #metrics-auth-username: \"\" metrics-auth-username: \"user_login_name\" #metrics-auth-password: \"\" metrics-auth-password: \"user_login_password\" Restart GtS:\nsudo systemctl restart gotosocial\nGo to:\nhttps://server.IP/metrics\nNow 404 the metrics page from external requests (if desired):\nsudo nano /etc/nginx/sites-available/GtS\nAdd:\n# 404 the metrics page from external requests location /metrics { return 404; } Check and reload the webserver:\nsudo nginx -t \u0026\u0026 sudo systemctl reload nginx\nAdd to Prometheus sudo nano /etc/prometheus/prometheus.yml\nAdd:\n# gotosocial/metrics job - job_name: \"gotosocial\" metrics_path: /metrics scheme: https basic_auth: username: \"prometheus_login_name\" password: \"prometheus_login_password\" static_configs: - targets: - gts.example.com Restart Prometheus:\nsudo systemctl restart prometheus\nsudo systemctl status prometheus\nGo to:\nhttp://server.IP:9090/targets\nTo see then new endpoint ‘gotosocial’\nAdd Dashboard to Grafana http://server.IP:3030/login\nUFW I already mentioned that I use UFW to limit access to the server.\nAs Prometheus and Grafana were already set up and running, there was no need for me to adjust or add to the existing UFW rules.\nAllow Prometheus:\nsudo ufw allow from 192.168.0.0/24 to any port 3030 comment \"Grafana traffic from LAN only\"\nAllow Grafana:\nsudo ufw allow from 192.168.0.0/24 to any port 9090 comment \"Prometheus traffic from LAN only\"\nBoth of the above allow access to Grafana and Prometheus from the LAN only.\nI have no interest in viewing my dashboard when away from home or allowing the data to be publicly accessible.\nMetrics Notes: Remember to allow access to the gotosocial_database to the grafana user\nsudo -u postgres psql\n\\connect gotosocial_database;\nGRANT CONNECT ON DATABASE \"gotosocial_database\" TO grafana;\nGRANT USAGE ON SCHEMA public TO grafana;\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO grafana;\nALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO grafana;\nThe Scripts A selection of SQL scripts for the GoToSocial PostgreSQL database.\nThese three scripts are the routines that I run daily, hourly and monthly.\nWhy?\nAll of the Fediverse software that I have used seem to retain too much data for too long.\nPersonally I see no need to keep the e.g. account details for every account that has passed through my timeline.\nLikewise, I do not need to store, archive and backup a huge amount of emoji from various Fediverse instances.\nSo I remove them, along with what I consider to be other extraneous info.\n(The list of data to be removed will probably grow as I dig deeper into the database.)\ngotosocial_tidy_hourly.sql WARNING:\nThis script will:\nTidy (DELETE FROM) the gotosocial db mentions table:\nDelete all mentions over n days old General (DELETE FROM) the gotosocial db statuses table:\nPer account deletes will be done later\nDelete all statuses over n days old\nDon’t remove any statuses from any accounts in the ‘users’ table\nPer account (DELETE FROM) the gotosocial db statuses table:\nDelete all statuses over n days old\nProbably makes sense to keep this in line with the ‘General’ setting\nDelete from: account_1_username account\nRetain pinned posts\nPer account (DELETE FROM) the gotosocial db statuses table:\nDelete all statuses over n days old\nProbably makes sense to keep account_2_username posts for longer\nDelete from: account_2_username account\nRetain pinned posts\nTidy (DELETE FROM) the gotosocial db status_faves table:\nDelete all status_faves over n days old Tidy (ANALYZE) any table that has had a DELETE performed upon it:\npublic.“mentions”\npublic.“statuses”\npublic.“status_faves\ngotosocial_tidy_daily.sql WARNING:\nThis script will:\nTidy (DELETE FROM) the gotosocial db accounts table:\nDon’t remove any accounts with the following id’s\nRemove any accounts that are not followers\nRemove any accounts that are not followees\nDon’t remove any accounts that are in the blocking table\nDon’t remove any accounts that are in the muting table\nTidy (DELETE FROM) the gotosocial db accounts_stats table:\nDon’t remove any stats with the following id’s\nRemove any stats that are not followers\nRemove any stats that are not followees\nTidy (DELETE FROM) the gotosocial db tokens table:\nKeeping the (bot) sessions Tidy (TRUNCATE) the gotosocial db tables:\npublic.clients\npublic.emojis\npublic.tombstones\nTidy (VACUUM.ANALYZE) the gotosocial db\ngotosocial_tidy_monthly.sql This script will:\nPerform a VACUUM FULL ANALYZE on the database and only needs to be run occasionally Bugs So far I have found very few bugs and certainly zero application killing ones.\nThere doesn’t seem to be a way to clear previously authorised sessions i.e. an old browser session, clearing the table stops the application from functioning.\nThe also_known_as field, if present, prevents the account from being found yet the account can still create content.\nNeither of the above would be encountered during normal everyday usage; it’s more me, tinkering with the guts of the database, something a normal person would ever do.\n",
  "wordCount" : "1602",
  "inLanguage": "en",
  "image":"https://boffinsblog.github.io/posts/moving-to-gotosocial/01_Boffin_Settings_Screen.webp","datePublished": "2025-01-02T19:21:23+01:00",
  "dateModified": "2025-01-02T19:21:23+01:00",
  "author":{
    "@type": "Person",
    "name": "Boffin"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://boffinsblog.github.io/posts/moving-to-gotosocial/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Boffins Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://boffinsblog.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://boffinsblog.github.io/" accesskey="h" title="Boffins Blog (Alt + H)">Boffins Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://boffinsblog.github.io/categories/featured/" title="Featured">
                    <span>Featured</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://boffinsblog.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://boffinsblog.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Moving to GoToSocial
    </h1>
    <div class="post-meta"><span title='2025-01-02 19:21:23 +0100 +0100'>January 2, 2025</span>&nbsp;·&nbsp;<span>8 min</span>&nbsp;·&nbsp;<span>Boffin</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#why" aria-label="Why?">Why?</a></li>
                <li>
                    <a href="#resources" aria-label="Resources">Resources</a></li>
                <li>
                    <a href="#preparatory-stuff" aria-label="Preparatory Stuff">Preparatory Stuff</a><ul>
                        
                <li>
                    <a href="#create-a-postgresql-gts-database" aria-label="Create a PostgreSQL GtS database">Create a PostgreSQL GtS database</a><ul>
                        
                <li>
                    <a href="#database-notes" aria-label="Database Notes:">Database Notes:</a></li></ul>
                </li>
                <li>
                    <a href="#nginx-configuration" aria-label="nginx Configuration">nginx Configuration</a></li>
                <li>
                    <a href="#ufw" aria-label="UFW">UFW</a></li>
                <li>
                    <a href="#certbot" aria-label="Certbot">Certbot</a></li></ul>
                </li>
                <li>
                    <a href="#install" aria-label="Install">Install</a></li>
                <li>
                    <a href="#configure" aria-label="Configure">Configure</a><ul>
                        
                <li>
                    <a href="#start-create-accounts" aria-label="Start, Create Account(s)">Start, Create Account(s)</a></li>
                <li>
                    <a href="#enable-the-systemd-service" aria-label="Enable the systemd service">Enable the systemd service</a></li>
                <li>
                    <a href="#authentication-with-the-api-get-a-token" aria-label="Authentication with the API (get a TOKEN)">Authentication with the API (get a TOKEN)</a></li>
                <li>
                    <a href="#landing-page-configyaml" aria-label="Landing Page (config.yaml)">Landing Page (config.yaml)</a></li></ul>
                </li>
                <li>
                    <a href="#metrics" aria-label="Metrics">Metrics</a><ul>
                        
                <li>
                    <a href="#add-to-prometheus" aria-label="Add to Prometheus">Add to Prometheus</a></li>
                <li>
                    <a href="#add-dashboard-to-grafana" aria-label="Add Dashboard to Grafana">Add Dashboard to Grafana</a></li>
                <li>
                    <a href="#ufw-1" aria-label="UFW">UFW</a><ul>
                        
                <li>
                    <a href="#metrics-notes" aria-label="Metrics Notes:">Metrics Notes:</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#the-scripts" aria-label="The Scripts">The Scripts</a></li>
                <li>
                    <a href="#bugs" aria-label="Bugs">Bugs</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="why">Why?<a hidden class="anchor" aria-hidden="true" href="#why">#</a></h2>
<p>It&rsquo;s more a question of &lsquo;Why Not?&rsquo;.</p>
<p>I was perfectly happy with 


  <a href="/posts/installing-iceshrimp-net/">Iceshrimp.NET</a>
 but wanted to try something new.</p>
<p>GtS seemed lighter and has hooks into Grafana and Prometheus so I&rsquo;d be able to mess around with Metrics.</p>
<h2 id="resources">Resources<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h2>
<p>

<a href="https://docs.gotosocial.org/en/latest/getting_started/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/getting_started/</a>
</p>
<p>

<a href="https://docs.gotosocial.org/en/latest/getting_started/installation/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/getting_started/installation/</a>
</p>
<p>

<a href="https://docs.gotosocial.org/en/latest/getting_started/installation/metal/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/getting_started/installation/metal/</a>
</p>
<h2 id="preparatory-stuff">Preparatory Stuff<a hidden class="anchor" aria-hidden="true" href="#preparatory-stuff">#</a></h2>
<h3 id="create-a-postgresql-gts-database">Create a PostgreSQL GtS database<a hidden class="anchor" aria-hidden="true" href="#create-a-postgresql-gts-database">#</a></h3>
<p>In a Terminal, do the following as normal user:</p>
<p><code>sudo -u postgres psql</code></p>
<p>Then, (line by line):</p>
<p><code>CREATE DATABASE gotosocial_database WITH LOCALE 'C.UTF-8' TEMPLATE template0;</code></p>
<p><code>CREATE USER gotosocial_user WITH PASSWORD 'super_long_password';</code></p>
<p><code>GRANT ALL PRIVILEGES ON DATABASE gotosocial_database TO gotosocial_user;</code></p>
<p><code>ALTER DATABASE gotosocial_database OWNER TO gotosocial_user;</code></p>
<h4 id="database-notes">Database Notes:<a hidden class="anchor" aria-hidden="true" href="#database-notes">#</a></h4>
<p>To list all the databases:</p>
<p><code>\l</code></p>
<p>To quit:</p>
<p><code>\q</code></p>
<p>To <strong>DROP</strong> a database (in case something gets bungled):</p>
<p><code>DROP DATABASE &quot;gotosocial_database&quot;;</code></p>
<p>To <strong>DROP</strong> a User (in case something gets bungled):</p>
<p><code>DROP USER &quot;gotosocial_user&quot;;</code></p>
<h3 id="nginx-configuration">nginx Configuration<a hidden class="anchor" aria-hidden="true" href="#nginx-configuration">#</a></h3>
<p>In a Terminal, do the following as normal user to create the <code>.conf</code> file:</p>
<p><code>sudo nano /etc/nginx/sites-available/GtS</code></p>
<p>Then add (changing as appropriate):</p>
<pre tabindex="0"><code>server {
  listen 80;
  # No need for an ipv6 address
  # listen [::]:80;
  server_name gts.example.com;

  location / {
    # set to 127.0.0.1 instead of localhost to work around https://stackoverflow.com/a/52550758
    proxy_pass http://127.0.0.1:8888;
    proxy_set_header Host $host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &#34;upgrade&#34;;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
  client_max_body_size 40M;
}
</code></pre><p>Check:</p>
<p><code>sudo nginx -t</code></p>
<p>Symlink:</p>
<p><code>sudo ln -s /etc/nginx/sites-available/GtS /etc/nginx/sites-enabled/</code></p>
<p>Check and reload the webserver:</p>
<p><code>sudo nginx -t &amp;&amp; sudo systemctl reload nginx</code></p>
<h3 id="ufw">UFW<a hidden class="anchor" aria-hidden="true" href="#ufw">#</a></h3>
<p>I use UFW to limit which services can connect to the server.</p>
<p>To authorise traffic on Port 8888, first see a verbose list of currently configured connections:</p>
<p><code>sudo ufw status verbose</code></p>
<p>Then, allow GtS on Port 8888:</p>
<p><code>sudo ufw allow 8888 comment &quot;GtS (GoToSocial) Traffic&quot;</code></p>
<p>To delete first see a list of currently configured connections:</p>
<p><code>sudo ufw status numbered</code></p>
<p>Then, delete the appropriate number:</p>
<p><code>sudo ufw delete #</code></p>
<h3 id="certbot">Certbot<a hidden class="anchor" aria-hidden="true" href="#certbot">#</a></h3>
<blockquote>
<p>Certbot is a free, open source software tool for automatically using Let’s Encrypt certificates on manually-administrated websites to enable HTTPS.</p>
<p>Certbot is made by the Electronic Frontier Foundation (EFF), a 501(c)3 nonprofit based in San Francisco, CA, that defends digital privacy, free speech, and innovation.</p>
<p>

<a href="https://certbot.eff.org/pages/about" target="_blank" rel="nofollow noopener noreferrer">https://certbot.eff.org/pages/about</a>
</p></blockquote>
<p>If needed Certbot is a Terminal command away:</p>
<p><code>sudo apt install certbot python3-certbot-nginx</code></p>
<p>Then, to generate a certificate:</p>
<p><code>sudo certbot</code></p>
<p>After cert has been deployed, re-edit the nginx <code>.conf</code> file:</p>
<p><code>sudo nano /etc/nginx/sites-available/GtS</code></p>
<p>To:</p>
<pre tabindex="0"><code>server {
  # HTTPS configuration
  listen                  443 ssl;

  # Server
  server_name             gts.example.com;

  # SSL
  ssl_certificate         /etc/letsencrypt/live/gts.example.com/fullchain.pem;
  ssl_certificate_key     /etc/letsencrypt/live/gts.example.com/privkey.pem;
  ssl_dhparam             /etc/letsencrypt/ssl-dhparams.pem;

  # logging
  access_log              /var/log/nginx/gts.example.com_access.log combined buffer=512k flush=1m;
  error_log               /var/log/nginx/gts.example.com_error.log warn;

  # security
  include                 nginxconfig.io/security.conf;
  include                 /etc/letsencrypt/options-ssl-nginx.conf;
  client_max_body_size    40M;

  # Proxy to Node
  location / {
    proxy_pass          http://127.0.0.1:8888;
    proxy_set_header    Host $host;
    proxy_set_header    Upgrade $http_upgrade;
    proxy_set_header    Connection &#34;upgrade&#34;;
    proxy_set_header    X-Forwarded-For $remote_addr;
    proxy_set_header    X-Forwarded-Proto $scheme;
  }
}

# HTTP redirect
server {
    if ($host = gts.example.com) {
      return 301 https://$host$request_uri;
    }

    listen                  80;
    server_name             gts.example.com;
    return                  404;
}
</code></pre><p>Check and reload the webserver:</p>
<p><code>sudo nginx -t &amp;&amp; sudo systemctl reload nginx</code></p>
<h2 id="install">Install<a hidden class="anchor" aria-hidden="true" href="#install">#</a></h2>
<p>Now that there is a database to store the info in, and a running webserver, it&rsquo;s finally time to install GtS.</p>
<p>Create a directory:</p>
<p><code>mkdir gotosocial</code></p>
<p>Move to the newly created directory:</p>
<p><code>cd gotosocial</code></p>
<p>Make a &lsquo;storage&rsquo; directory:</p>
<p><code>mkdir storage</code></p>
<p>Grab the latest GtS bundle:</p>
<p><code>wget https://github.com/superseriousbusiness/gotosocial/releases/download/v0.17.1/gotosocial_0.17.1_linux_arm64.tar.gz</code></p>
<p>Unzip everything:</p>
<p><code>tar -xzf gotosocial_0.17.1_linux_arm64.tar.gz</code></p>
<p>Tidy up:</p>
<p><code>rm gotosocial_0.17.1_linux_arm64.tar.gz</code></p>
<h2 id="configure">Configure<a hidden class="anchor" aria-hidden="true" href="#configure">#</a></h2>
<p>Copy the example <code>config</code> file before making any changes:</p>
<p><code>cp example/config.yaml config.yaml</code></p>
<p>Open it:</p>
<p><code>nano config.yaml</code></p>
<p>I made the following adjustments (the descriptors are self-explanatory):</p>
<pre tabindex="0"><code>#host: &#34;localhost&#34;
host: &#34;gts.example.com&#34;

#account-domain: &#34;&#34;
account-domain: &#34;example.com&#34;

#bind-address: &#34;0.0.0.0&#34;
bind-address: &#34;localhost&#34;

#Port 8080 is already in use by something else, so change it to something else
#port: 8080
port: 8888

#db-address: &#34;&#34;
db-address: &#34;localhost&#34;

#db-user: &#34;&#34;
db-user: &#34;gotosocial_user&#34;

#db-password: &#34;&#34;
db-password: &#34;super_long_password&#34;

#db-database: &#34;gotosocial&#34;
db-database: &#34;gotosocial_database&#34;

#media-remote-cache-days: 7
media-remote-cache-days: 1

#media-cleanup-every: &#34;24h&#34;
media-cleanup-every: &#34;8h&#34;
</code></pre><h3 id="start-create-accounts">Start, Create Account(s)<a hidden class="anchor" aria-hidden="true" href="#start-create-accounts">#</a></h3>
<p>The moment of truth!</p>
<p>Start the GtS server:</p>
<p><code>./gotosocial --config-path ./config.yaml server start</code></p>
<p>Create the first user(s).</p>
<p>

<a href="https://docs.gotosocial.org/en/latest/getting_started/user_creation/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/getting_started/user_creation/</a>
</p>
<p>Personally, I have two accounts:</p>
<ul>
<li>An Admin account</li>
<li>A general non privileged (normal) account</li>
</ul>
<p>YMMV.</p>
<p>Add an account:</p>
<p><code>cd ~/gotosocial</code></p>
<pre tabindex="0"><code>./gotosocial --config-path ~/gotosocial/config.yaml \
  admin account create \
  --username admin_account \
  --email admin_account@example.com \
  --password &#39;admin_account_password&#39;
</code></pre><p>Promote to Admin:</p>
<p><code>./gotosocial admin account promote --username admin_account --config-path config.yaml</code></p>
<p>Add another account:</p>
<pre tabindex="0"><code>./gotosocial --config-path ~/gotosocial/config.yaml \
  admin account create \
  --username general_account \
  --email general_account@example.com \
  --password &#39;general_account_password&#39;
</code></pre><p>Do not promote to Admin.</p>
<h3 id="enable-the-systemd-service">Enable the systemd service<a hidden class="anchor" aria-hidden="true" href="#enable-the-systemd-service">#</a></h3>
<p>Create the systemd service that will start when the server reboots.</p>
<p>

<a href="https://codeberg.org/superseriousbusiness/gotosocial/src/branch/main/example/gotosocial.service" target="_blank" rel="nofollow noopener noreferrer">https://codeberg.org/superseriousbusiness/gotosocial/src/branch/main/example/gotosocial.service</a>
</p>
<p><code>sudo nano /etc/systemd/system/gotosocial.service</code></p>
<p>Run:</p>
<p><code>sudo systemctl enable --now gotosocial.service</code></p>
<p><code>sudo systemctl start gotosocial.service</code></p>
<p>Check the service status:</p>
<p><code>sudo systemctl status gotosocial.service</code></p>
<h3 id="authentication-with-the-api-get-a-token">Authentication with the API (get a TOKEN)<a hidden class="anchor" aria-hidden="true" href="#authentication-with-the-api-get-a-token">#</a></h3>
<p>I have a couple of bots that need to post autonomously using the API.</p>
<p>This functionality needs an an Auth token:</p>
<p>

<a href="https://docs.gotosocial.org/en/latest/api/authentication/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/api/authentication/</a>
</p>
<h3 id="landing-page-configyaml">Landing Page (config.yaml)<a hidden class="anchor" aria-hidden="true" href="#landing-page-configyaml">#</a></h3>
<p>As this is a self-hosted single user instance, rather than the generic GtS homepage I would like my Account Profile to be displayed.</p>
<p><code>nano gotosocial/config.yaml</code></p>
<pre tabindex="0"><code>#landing-page-user: &#34;&#34;
landing-page-user: &#34;general_account&#34;
</code></pre><p><code>sudo systemctl restart gotosocial</code></p>
<h2 id="metrics">Metrics<a hidden class="anchor" aria-hidden="true" href="#metrics">#</a></h2>
<p>

<a href="https://docs.gotosocial.org/en/latest/advanced/metrics/" target="_blank" rel="nofollow noopener noreferrer">https://docs.gotosocial.org/en/latest/advanced/metrics/</a>
</p>
<p>I&rsquo;m a big fan of 


  <a href="/posts/iceshrimp-net-grafana-dashboard/">Metrics and Dashboards</a>
, so of course I&rsquo;m going to enable this feature:</p>
<p>Edit the <code>config.yaml</code> file.</p>
<p>I made the following adjustments (the descriptors are self-explanatory):</p>
<p><code>nano gotosocial/config.yaml</code></p>
<pre tabindex="0"><code>#metrics-enabled: false
metrics-enabled: true

#metrics-auth-enabled: false
metrics-auth-enabled: true

#metrics-auth-username: &#34;&#34;
metrics-auth-username: &#34;user_login_name&#34;

#metrics-auth-password: &#34;&#34;
metrics-auth-password: &#34;user_login_password&#34;
</code></pre><p>Restart GtS:</p>
<p><code>sudo systemctl restart gotosocial</code></p>
<p>Go to:</p>
<p>https://server.IP/metrics</p>
<p>Now 404 the metrics page from external requests (if desired):</p>
<p><code>sudo nano /etc/nginx/sites-available/GtS</code></p>
<p>Add:</p>
<pre tabindex="0"><code># 404 the metrics page from external requests
location /metrics {
  return 404;
}
</code></pre><p>Check and reload the webserver:</p>
<p><code>sudo nginx -t &amp;&amp; sudo systemctl reload nginx</code></p>
<h3 id="add-to-prometheus">Add to Prometheus<a hidden class="anchor" aria-hidden="true" href="#add-to-prometheus">#</a></h3>
<p><code>sudo nano /etc/prometheus/prometheus.yml</code></p>
<p>Add:</p>
<pre tabindex="0"><code># gotosocial/metrics job
  - job_name: &#34;gotosocial&#34;
    metrics_path: /metrics
    scheme: https
    basic_auth:
    username: &#34;prometheus_login_name&#34;
    password: &#34;prometheus_login_password&#34;
    static_configs:
    - targets:
    - gts.example.com
</code></pre><p>Restart Prometheus:</p>
<p><code>sudo systemctl restart prometheus</code></p>
<p><code>sudo systemctl status prometheus</code></p>
<p>Go to:</p>
<p>http://server.IP:9090/targets</p>
<p>To see then new endpoint &lsquo;gotosocial&rsquo;</p>
<h3 id="add-dashboard-to-grafana">Add Dashboard to Grafana<a hidden class="anchor" aria-hidden="true" href="#add-dashboard-to-grafana">#</a></h3>
<p>http://server.IP:3030/login</p>
<h3 id="ufw-1">UFW<a hidden class="anchor" aria-hidden="true" href="#ufw-1">#</a></h3>
<p>I already mentioned that I use UFW to limit access to the server.</p>
<p>As Prometheus and Grafana were already set up and running, there was no need for me to adjust or add to the existing UFW rules.</p>
<p>Allow Prometheus:</p>
<p><code>sudo ufw allow from 192.168.0.0/24 to any port 3030 comment &quot;Grafana traffic from LAN only&quot;</code></p>
<p>Allow Grafana:</p>
<p><code>sudo ufw allow from 192.168.0.0/24 to any port 9090 comment &quot;Prometheus traffic from LAN only&quot;</code></p>
<p>Both of the above allow access to Grafana and Prometheus from the LAN only.</p>
<p>I have no interest in viewing my dashboard when away from home or allowing the data to be publicly accessible.</p>
<h4 id="metrics-notes">Metrics Notes:<a hidden class="anchor" aria-hidden="true" href="#metrics-notes">#</a></h4>
<p>Remember to allow access to the gotosocial_database to the grafana user</p>
<p><code>sudo -u postgres psql</code></p>
<p><code>\connect gotosocial_database;</code></p>
<p><code>GRANT CONNECT ON DATABASE &quot;gotosocial_database&quot; TO grafana;</code></p>
<p><code>GRANT USAGE ON SCHEMA public TO grafana;</code></p>
<p><code>GRANT SELECT ON ALL TABLES IN SCHEMA public TO grafana;</code></p>
<p><code>ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO grafana;</code></p>
<h2 id="the-scripts">The Scripts<a hidden class="anchor" aria-hidden="true" href="#the-scripts">#</a></h2>
<p>A selection of SQL scripts for the GoToSocial PostgreSQL database.</p>
<p>These three scripts are the routines that I run daily, hourly and monthly.</p>
<p>Why?</p>
<p>All of the Fediverse software that I have used seem to retain too much data for too long.</p>
<p>Personally I see no need to keep the e.g. account details for <strong>every</strong> account that has passed through my timeline.</p>
<p>Likewise, I do not need to store, archive and backup a huge amount of emoji from various Fediverse instances.</p>
<p>So I remove them, along with what I consider to be other extraneous info.</p>
<p>(The list of data to be removed will probably grow as I dig deeper into the database.)</p>
<h3 id="gotosocial_">

<a href="https://github.com/BoffinsBlog/GoToSocial/blob/main/sql/gotosocial_tidy_hourly.sql" target="_blank" rel="nofollow noopener noreferrer">gotosocial_tidy_hourly.sql</a>
</h3>
<p><strong>WARNING:</strong></p>
<p>This script will:</p>
<p>Tidy (DELETE FROM) the gotosocial db mentions table:</p>
<ul>
<li>Delete all mentions over n days old</li>
</ul>
<p>General (DELETE FROM) the gotosocial db statuses table:</p>
<ul>
<li>
<p>Per account deletes will be done later</p>
</li>
<li>
<p>Delete all statuses over n days old</p>
</li>
<li>
<p>Don&rsquo;t remove any statuses from any accounts in the &lsquo;users&rsquo; table</p>
</li>
</ul>
<p>Per account (DELETE FROM) the gotosocial db statuses table:</p>
<ul>
<li>
<p>Delete all statuses over n days old</p>
</li>
<li>
<p>Probably makes sense to keep this in line with the &lsquo;General&rsquo; setting</p>
</li>
<li>
<p>Delete from: account_1_username account</p>
</li>
<li>
<p>Retain pinned posts</p>
</li>
</ul>
<p>Per account (DELETE FROM) the gotosocial db statuses table:</p>
<ul>
<li>
<p>Delete all statuses over n days old</p>
</li>
<li>
<p>Probably makes sense to keep account_2_username posts for longer</p>
</li>
<li>
<p>Delete from: account_2_username account</p>
</li>
<li>
<p>Retain pinned posts</p>
</li>
</ul>
<p>Tidy (DELETE FROM) the gotosocial db status_faves table:</p>
<ul>
<li>Delete all status_faves over n days old</li>
</ul>
<p>Tidy (ANALYZE) any table that has had a DELETE performed upon it:</p>
<ul>
<li>
<p>public.&ldquo;mentions&rdquo;</p>
</li>
<li>
<p>public.&ldquo;statuses&rdquo;</p>
</li>
<li>
<p>public.&ldquo;status_faves</p>
</li>
</ul>
<h3 id="gotosocial_-1">

<a href="https://github.com/BoffinsBlog/GoToSocial/blob/main/sql/gotosocial_tidy_daily.sql" target="_blank" rel="nofollow noopener noreferrer">gotosocial_tidy_daily.sql</a>
</h3>
<p><strong>WARNING:</strong></p>
<p>This script will:</p>
<p>Tidy (DELETE FROM) the gotosocial db accounts table:</p>
<ul>
<li>
<p>Don&rsquo;t remove any accounts with the following id&rsquo;s</p>
</li>
<li>
<p>Remove any accounts that are not followers</p>
</li>
<li>
<p>Remove any accounts that are not followees</p>
</li>
<li>
<p>Don&rsquo;t remove any accounts that are in the blocking table</p>
</li>
<li>
<p>Don&rsquo;t remove any accounts that are in the muting table</p>
</li>
</ul>
<p>Tidy (DELETE FROM) the gotosocial db accounts_stats table:</p>
<ul>
<li>
<p>Don&rsquo;t remove any stats with the following id&rsquo;s</p>
</li>
<li>
<p>Remove any stats that are not followers</p>
</li>
<li>
<p>Remove any stats that are not followees</p>
</li>
</ul>
<p>Tidy (DELETE FROM) the gotosocial db tokens table:</p>
<ul>
<li>Keeping the (bot) sessions</li>
</ul>
<p>Tidy (TRUNCATE) the gotosocial db tables:</p>
<ul>
<li>
<p>public.clients</p>
</li>
<li>
<p>public.emojis</p>
</li>
<li>
<p>public.tombstones</p>
</li>
</ul>
<p>Tidy (VACUUM.ANALYZE) the gotosocial db</p>
<h3 id="gotosocial_-2">

<a href="https://github.com/BoffinsBlog/GoToSocial/blob/main/sql/gotosocial_tidy_monthly.sql" target="_blank" rel="nofollow noopener noreferrer">gotosocial_tidy_monthly.sql</a>
</h3>
<p>This script will:</p>
<ul>
<li>Perform a VACUUM FULL ANALYZE on the database and only needs to be run occasionally</li>
</ul>
<h2 id="bugs">Bugs<a hidden class="anchor" aria-hidden="true" href="#bugs">#</a></h2>
<p>So far I have found very few bugs and certainly zero application killing ones.</p>
<p>There doesn&rsquo;t seem to be a way to clear previously authorised sessions i.e. an old browser session, clearing the table stops the application from functioning.</p>
<p>The <code>also_known_as</code> field, if present, prevents the account from being found yet the account can still create content.</p>
<p>Neither of the above would be encountered during normal everyday usage; it&rsquo;s more me, tinkering with the guts of the database, something a normal person would ever do.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://boffinsblog.github.io/tags/fediverse/">Fediverse</a></li>
      <li><a href="https://boffinsblog.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://boffinsblog.github.io/tags/raspberry-pi/">Raspberry Pi</a></li>
      <li><a href="https://boffinsblog.github.io/tags/self-hosting/">Self Hosting</a></li>
      <li><a href="https://boffinsblog.github.io/tags/web-servers/">Web-Servers</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://boffinsblog.github.io/posts/prometheus-scraper/">
    <span class="title">« Prev</span>
    <br>
    <span>Prometheus Scraper</span>
  </a>
  <a class="next" href="https://boffinsblog.github.io/posts/the-travelling-packet/">
    <span class="title">Next »</span>
    <br>
    <span>The Travelling Packet</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://boffinsblog.github.io/">Boffins Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <br>
        <p><a href="https://www.creativecommons.org/licenses/by-nc/4.0/deed.en" rel="noopener noreferrer" target="_blank">This work is licensed under CC BY-NC-SA 4.0</a></p>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
