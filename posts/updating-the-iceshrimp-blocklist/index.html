<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Updating the Iceshrimp Blocklist | Boffins Blog</title>
<meta name="keywords" content="Fediverse, Linux, Python, Raspberry Pi, Self Hosting, Web-Servers">
<meta name="description" content="Right now updating the blocklists is a manual process, this is a way of updating the Iceshrimp blocklist automatically using Python and cron.">
<meta name="author" content="Boffin">
<link rel="canonical" href="https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e13be8719bbabf4005d0d2b0f19dba897f7d41b2e807b64c47ee1436d126ab01.css" integrity="sha256-4TvocZu6v0AF0NKw8Z26iX99QbLoB7ZMR&#43;4UNtEmqwE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://boffinsblog.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://boffinsblog.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://boffinsblog.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://boffinsblog.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://boffinsblog.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/">
  <meta property="og:site_name" content="Boffins Blog">
  <meta property="og:title" content="Updating the Iceshrimp Blocklist">
  <meta property="og:description" content="Right now updating the blocklists is a manual process, this is a way of updating the Iceshrimp blocklist automatically using Python and cron.">
  <meta property="og:locale" content="en-gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-14T08:48:04+00:00">
    <meta property="article:modified_time" content="2024-01-14T08:48:04+00:00">
    <meta property="article:tag" content="Fediverse">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="Self Hosting">
    <meta property="article:tag" content="Web-Servers">
    <meta property="og:image" content="https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/01_Federation_Management_Screenshot.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/01_Federation_Management_Screenshot.webp">
<meta name="twitter:title" content="Updating the Iceshrimp Blocklist">
<meta name="twitter:description" content="Right now updating the blocklists is a manual process, this is a way of updating the Iceshrimp blocklist automatically using Python and cron.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://boffinsblog.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Updating the Iceshrimp Blocklist",
      "item": "https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Updating the Iceshrimp Blocklist",
  "name": "Updating the Iceshrimp Blocklist",
  "description": "Right now updating the blocklists is a manual process, this is a way of updating the Iceshrimp blocklist automatically using Python and cron.",
  "keywords": [
    "Fediverse", "Linux", "Python", "Raspberry Pi", "Self Hosting", "Web-Servers"
  ],
  "articleBody": "“Its my instance and I’ll Block if I want to, Block if I want to…” Right now, updating the Iceshrimp Blocklist is a manual task; these scripts automate that process.\nNote:\nI am well aware of the controversy and debate around Blocklist(s) but the fact remains that they exist and people use them. This is a post about how to automate the currently manual process.\nLike many Instance owners and Administrators, I employ Blocklists.\nThese Blocklists need regular updating, mainly because a Domain may be on a Blocklist one week and removed from that Blocklist later on.\nWhen using Iceshrimp, this process is a manual one:\nFind a suitable blocklist\nDownload the list (usually a .csv file)\nExtract the column of Domains\nCopy that column to the clipboard\nLog onto Iceshrimp as an Administrator\nGo to ‘Control Panel | Federation Management’\nDelete any old Domain names in the text box\nPaste in the clipboard contents\nClearly this is less than ideal.\nUpdating the Iceshrimp Blocklist Python Scripts This first script replaces that manual task by; collecting a single online list, doing the data extraction, and then inserting the Domain info into the PostgreSQL database using Python.\nupdate_blocklist_single.py This requires the following:\nThe remote URL link to a .csv Blocklist file\nA local path setting\nThe local filename for the .csv file (this can be the same as the remote name)\nFinally, a local filename for the log file\n#!/usr/bin/env python # -*- coding: utf-8 -*- # The url library import urllib.request # The pandas library (pip install pandas) import pandas as pd # The PostgreSQL library (pip install psycopg2) import psycopg2 # Local path and filenames blocklist_path = \"/home/foo/path/to/update_iceshrimp_blocklist/\" blocklist_filename = \"blocklist_single.csv\" blocklist_log_path = \"/home/foo/Logs/\" blocklist_log_filename = \"iceshrimp_blocklist_single_updated\" # Link to the Blocklist to be used url = (\"https://codeberg.org/oliphant/blocklists/raw/branch/main/blocklists/_unified_tier0_blocklist.csv\") # Go grab the Blocklist urllib.request.urlretrieve(url, blocklist_path+blocklist_filename) # Read the CSV file into a pandas DataFrame df = pd.read_csv(blocklist_path+blocklist_filename) # Select the first column (column 0) and convert it to a text Series blocklist_series = df.iloc[:, 0].astype(str) # Join the text Series into a single string with a comma blocklist_string = ','.join(blocklist_series) # Establish a Postgres DB connection conn = psycopg2.connect(host=\"127.0.0.1\", database=\"iceshrimp_db\", user=\"iceshrimp_user\", password=\"iceshrimp_db_user_password\", port= '5432') # Create a cursor object using the cursor() method cursor = conn.cursor() # Prepare the SQL query to UPDATE the 'blockedHosts' field in the 'meta' table in the database table_modification = \"\"\"UPDATE meta SET \"blockedHosts\" = '{\"\"\" + blocklist_string + \"\"\"}' WHERE id = 'x'\"\"\" # Execute and error-trap try: # Execute the SQL command cursor.execute(table_modification) print(\"Executed and UPDATED\") # Commit the changes to the database conn.commit() print(\"UPDATE Committed\") # Create a log file to show that the UPDATE has successfully completed open(blocklist_log_path+blocklist_log_filename, 'w') print(\"UPDATE log file created\") except: # Roll back in case of error conn.rollback() print(\"UPDATE Failed and rolled back\") # Close the connection conn.close() print(\"Connection CLOSED\") This second script replaces that manual task by; collecting multiple online lists, doing the data extraction, collating them, removing any duplicates and then inserting the Domain info into the PostgreSQL database using Python.\nupdate_blocklist_multiple.py Note:\nThis process will work just as well with one entry in the list as it will with multiple entries.\nThis requires the following:\nA ‘ blocklist_multiple.txt ‘ file that contains URLs to the remote .csv files\nAn optional .csv file containing URLS to be blocked; a ‘ personal_blocklist.csv ‘\nA local path setting\nA local filename for the log file\n#!/usr/bin/env python # -*- coding: utf-8 -*- # The url library import urllib.request # The pandas library (pip install pandas) import pandas as pd # The PostgreSQL library (pip install psycopg2) import psycopg2 # Local path and filenames blocklist_path = \"/home/foo/path/to/update_iceshrimp_blocklist/\" blocklist_filename = \"blocklist_multiple.txt\" blocklist_log_path = \"/home/foo/Logs/\" blocklist_log_filename = \"iceshrimp_blocklist_multiple_updated\" # Python pathname pattern matching import glob # Download all of the *.csv files in 'blocklist.txt' into the current directory with open(blocklist_path+blocklist_filename) as f: for line in f: url = line blocklist_filename = url.split('/', -1)[-1] urllib.request.urlretrieve(url, blocklist_path+blocklist_filename.rstrip('\\n')) # Put all of the *.csv files in the current directory into a single DataFrame files = glob.glob(blocklist_path+\"*.csv\") content = [] # Loop through all the *.csv files for filename in files: df = pd.read_csv(filename, index_col=None) print(len(df.index), \"rows in\", filename) content.append(df) # Convert 'content' to a DataFrame df = pd.concat(content) # Print the # of DataFrame rows print(len(df.index), \"rows in the DataFrame\") # Select the first column (column 0) and convert it to a text Series blocklist_series = df.iloc[:, 0].astype(str) # Make the Series unique blocklist_series = pd.unique(blocklist_series) # Print the # of rows in the Series print(pd.Series(blocklist_series).count(), \"unique rows in the Series\") # Join the text Series into a single string with a comma blocklist_string = ','.join(blocklist_series) # Establish a Postgres DB connection conn = psycopg2.connect(host=\"127.0.0.1\", database=\"iceshrimp_db\", user=\"iceshrimp_user\", password=\"iceshrimp_db_user_password\", port= '5432') # Create a cursor object using the cursor() method cursor = conn.cursor() # Prepare the SQL query to UPDATE the 'blockedHosts' field in the 'meta' table in the database table_modification = \"\"\"UPDATE meta SET \"blockedHosts\" = '{\"\"\" + blocklist_string + \"\"\"}' WHERE id = 'x'\"\"\" # Execute and error-trap try: # Execute the SQL command cursor.execute(table_modification) print(\"Executed and UPDATED\") # Commit the changes to the database conn.commit() print(\"UPDATE Committed\") # Create a log file to show that the UPDATE has successfully completed open(blocklist_log_path+blocklist_log_filename, 'w') print(\"UPDATE log file created\") except: # Roll back in case of error conn.rollback() print(\"UPDATE Failed and rolled back\") # Close the connection conn.close() print(\"Connection CLOSED\") blocklist_multiple.txt This is the list of URLs that link to the .csv Blocklist(s):\nhttps://codeberg.org/oliphant/blocklists/raw/branch/main/blocklists/_unified_tier0_blocklist.csv https://seirdy.one/pb/pleroma.envs.net.csv personal_blocklist.csv Additionally, a ‘personal_blocklist’ can be created (this file can be named what you like as long as it is a .csv file).\ndomain naughty_fedi.com Updating the Iceshrimp Blocklist crontab In addition to running the script manually, either script can be executed nightly, at midnight, from a normal crontab (crontab -e from a Terminal).\n# Update the iceshrimp blocklist daily at midnight #0 0 * * * python3 /home/foo/path/to/script/update_blocklist_single.py 0 0 * * * python3 /home/foo/path/to/script/update_blocklist_multiple.py # Finally (I did mention this in a prior post but it bears repeating.)\nFor anyone interested in getting into the SQL side, pgAdmin is a useful tool.\nI installed it using:\ncurl -fsS https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo gpg --dearmor -o /usr/share/keyrings/packages-pgadmin-org.gpg\nsudo sh -c 'echo \"deb [signed-by=/usr/share/keyrings/packages-pgadmin-org.gpg] https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/jammy pgadmin4 main\" \u003e /etc/apt/sources.list.d/pgadmin4.list \u0026\u0026 apt update'\nsudo apt update\nsudo apt install pgadmin4\npgAdmin Screenshot\nHowever you Fediverse, Enjoy!\nUPDATE Iceshrimp is moving to a .NET framework.\nAdditional scripts for updating a blocklist when running Iceshrimp.NET can be found at .\n",
  "wordCount" : "1078",
  "inLanguage": "en",
  "image":"https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/01_Federation_Management_Screenshot.webp","datePublished": "2024-01-14T08:48:04Z",
  "dateModified": "2024-01-14T08:48:04Z",
  "author":{
    "@type": "Person",
    "name": "Boffin"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://boffinsblog.github.io/posts/updating-the-iceshrimp-blocklist/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Boffins Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://boffinsblog.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://boffinsblog.github.io/" accesskey="h" title="Boffins Blog (Alt + H)">Boffins Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://boffinsblog.github.io/categories/featured/" title="Featured">
                    <span>Featured</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://boffinsblog.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://boffinsblog.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://boffinsblog.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Updating the Iceshrimp Blocklist
    </h1>
    <div class="post-meta"><span title='2024-01-14 08:48:04 +0000 GMT'>January 14, 2024</span>&nbsp;·&nbsp;<span>6 min</span>&nbsp;·&nbsp;<span>Boffin</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#its-my-instance-and-ill-block-if-i-want-to-block-if-i-want-to" aria-label="“Its my instance and I’ll Block if I want to, Block if I want to…”">“Its my instance and I’ll Block if I want to, Block if I want to…”</a></li>
                <li>
                    <a href="#updating-the-iceshrimp-blocklist-python-scripts" aria-label="Updating the Iceshrimp Blocklist Python Scripts">Updating the Iceshrimp Blocklist Python Scripts</a></li>
                <li>
                    <a href="#updating-the-iceshrimp-blocklist-crontab" aria-label="Updating the Iceshrimp Blocklist crontab">Updating the Iceshrimp Blocklist crontab</a></li>
                <li>
                    <a href="#finally" aria-label="Finally">Finally</a></li>
                <li>
                    <a href="#update" aria-label="UPDATE">UPDATE</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="its-my-instance-and-ill-block-if-i-want-to-block-if-i-want-to">“Its my instance and I’ll Block if I want to, Block if I want to…”<a hidden class="anchor" aria-hidden="true" href="#its-my-instance-and-ill-block-if-i-want-to-block-if-i-want-to">#</a></h2>
<p>Right now, updating the Iceshrimp Blocklist is a manual task; these scripts automate that process.</p>
<p><strong>Note:</strong><br>
I am well aware of the controversy and debate around Blocklist(s) but the fact remains that they exist and people use them. This is a post about how to automate the currently manual process.</p>
<p>Like many Instance owners and Administrators, I employ Blocklists.</p>
<p>These Blocklists need regular updating, mainly because a Domain may be on a Blocklist one week and removed from that Blocklist later on.</p>
<p>When using Iceshrimp, this process is a manual one:</p>
<ul>
<li>
<p>Find a suitable blocklist</p>
</li>
<li>
<p>Download the list (usually a .csv file)</p>
</li>
<li>
<p>Extract the column of Domains</p>
</li>
<li>
<p>Copy that column to the clipboard</p>
</li>
<li>
<p>Log onto Iceshrimp as an Administrator</p>
</li>
<li>
<p>Go to ‘Control Panel | Federation Management’</p>
</li>
<li>
<p>Delete any old Domain names in the text box</p>
</li>
<li>
<p>Paste in the clipboard contents</p>
</li>
</ul>
<p>Clearly this is less than ideal.</p>
<h2 id="updating-the-iceshrimp-blocklist-python-scripts">Updating the Iceshrimp Blocklist Python Scripts<a hidden class="anchor" aria-hidden="true" href="#updating-the-iceshrimp-blocklist-python-scripts">#</a></h2>
<p>This first script replaces that manual task by; collecting a single online list, doing the data extraction, and then inserting the Domain info into the PostgreSQL database using Python.</p>
<h3 id="update_">

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/update_blocklist_single.py" target="_blank" rel="nofollow noopener noreferrer">update_blocklist_single.py</a>
</h3>
<p>This requires the following:</p>
<ul>
<li>
<p>The remote URL link to a .csv Blocklist file</p>
</li>
<li>
<p>A local path setting</p>
</li>
<li>
<p>The local filename for the .csv file (this can be the same as the remote name)</p>
</li>
<li>
<p>Finally, a local filename for the log file</p>
</li>
</ul>
<pre tabindex="0"><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

# The url library
import urllib.request

# The pandas library (pip install pandas)
import pandas as pd

# The PostgreSQL library (pip install psycopg2)
import psycopg2

# Local path and filenames
blocklist_path = &#34;/home/foo/path/to/update_iceshrimp_blocklist/&#34;
blocklist_filename = &#34;blocklist_single.csv&#34;
blocklist_log_path = &#34;/home/foo/Logs/&#34;
blocklist_log_filename = &#34;iceshrimp_blocklist_single_updated&#34;

# Link to the Blocklist to be used
url = (&#34;https://codeberg.org/oliphant/blocklists/raw/branch/main/blocklists/_unified_tier0_blocklist.csv&#34;)

# Go grab the Blocklist
urllib.request.urlretrieve(url, blocklist_path+blocklist_filename)

# Read the CSV file into a pandas DataFrame
df = pd.read_csv(blocklist_path+blocklist_filename)

# Select the first column (column 0) and convert it to a text Series
blocklist_series = df.iloc[:, 0].astype(str)

# Join the text Series into a single string with a comma
blocklist_string = &#39;,&#39;.join(blocklist_series)

# Establish a Postgres DB connection
conn = psycopg2.connect(host=&#34;127.0.0.1&#34;, database=&#34;iceshrimp_db&#34;, user=&#34;iceshrimp_user&#34;, password=&#34;iceshrimp_db_user_password&#34;, port= &#39;5432&#39;)

# Create a cursor object using the cursor() method
cursor = conn.cursor()

# Prepare the SQL query to UPDATE the &#39;blockedHosts&#39; field in the &#39;meta&#39; table in the database
table_modification = &#34;&#34;&#34;UPDATE meta SET &#34;blockedHosts&#34; = &#39;{&#34;&#34;&#34; + blocklist_string + &#34;&#34;&#34;}&#39; WHERE id = &#39;x&#39;&#34;&#34;&#34;

# Execute and error-trap
try:
    # Execute the SQL command
    cursor.execute(table_modification)
    print(&#34;Executed and UPDATED&#34;)

    # Commit the changes to the database
    conn.commit()
    print(&#34;UPDATE Committed&#34;)

    # Create a log file to show that the UPDATE has successfully completed
    open(blocklist_log_path+blocklist_log_filename, &#39;w&#39;)
    print(&#34;UPDATE log file created&#34;)

except:
    # Roll back in case of error
    conn.rollback()
    print(&#34;UPDATE Failed and rolled back&#34;)

# Close the connection
conn.close()
print(&#34;Connection CLOSED&#34;)
</code></pre><p>This second script replaces that manual task by; collecting multiple online lists, doing the data extraction, collating them, removing any duplicates and then inserting the Domain info into the PostgreSQL database using Python.</p>
<h3 id="update_-1">

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/update_blocklist_multiple.py" target="_blank" rel="nofollow noopener noreferrer">update_blocklist_multiple.py</a>
</h3>
<p><strong>Note:</strong><br>
This process will work just as well with one entry in the list as it will with multiple entries.</p>
<p>This requires the following:</p>
<ul>
<li>
<p>A ‘

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/blocklist_multiple.txt" target="_blank" rel="nofollow noopener noreferrer">blocklist_multiple.txt</a>
‘ file that contains URLs to the remote .csv files</p>
</li>
<li>
<p>An <strong>optional</strong> .csv file containing URLS to be blocked; a ‘

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/personal_blocklist.csv" target="_blank" rel="nofollow noopener noreferrer">personal_blocklist.csv</a>
‘</p>
</li>
<li>
<p>A local path setting</p>
</li>
<li>
<p>A local filename for the log file</p>
</li>
</ul>
<pre tabindex="0"><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

# The url library
import urllib.request

# The pandas library (pip install pandas)
import pandas as pd

# The PostgreSQL library (pip install psycopg2)
import psycopg2

# Local path and filenames
blocklist_path = &#34;/home/foo/path/to/update_iceshrimp_blocklist/&#34;
blocklist_filename = &#34;blocklist_multiple.txt&#34;
blocklist_log_path = &#34;/home/foo/Logs/&#34;
blocklist_log_filename = &#34;iceshrimp_blocklist_multiple_updated&#34;

# Python pathname pattern matching
import glob

# Download all of the *.csv files in &#39;blocklist.txt&#39; into the current directory
with open(blocklist_path+blocklist_filename) as f:
    for line in f:
        url = line
        blocklist_filename = url.split(&#39;/&#39;, -1)[-1]
        urllib.request.urlretrieve(url, blocklist_path+blocklist_filename.rstrip(&#39;\n&#39;))

# Put all of the *.csv files in the current directory into a single DataFrame
files = glob.glob(blocklist_path+&#34;*.csv&#34;)
content = []

# Loop through all the *.csv files
for filename in files:
    df = pd.read_csv(filename, index_col=None)
    print(len(df.index), &#34;rows in&#34;, filename)
    content.append(df)

# Convert &#39;content&#39; to a DataFrame
df = pd.concat(content)

# Print the # of DataFrame rows
print(len(df.index), &#34;rows in the DataFrame&#34;)

# Select the first column (column 0) and convert it to a text Series
blocklist_series = df.iloc[:, 0].astype(str)

# Make the Series unique
blocklist_series = pd.unique(blocklist_series)

# Print the # of rows in the Series
print(pd.Series(blocklist_series).count(), &#34;unique rows in the Series&#34;)

# Join the text Series into a single string with a comma
blocklist_string = &#39;,&#39;.join(blocklist_series)

# Establish a Postgres DB connection
conn = psycopg2.connect(host=&#34;127.0.0.1&#34;, database=&#34;iceshrimp_db&#34;, user=&#34;iceshrimp_user&#34;, password=&#34;iceshrimp_db_user_password&#34;, port= &#39;5432&#39;)

# Create a cursor object using the cursor() method
cursor = conn.cursor()

# Prepare the SQL query to UPDATE the &#39;blockedHosts&#39; field in the &#39;meta&#39; table in the database
table_modification = &#34;&#34;&#34;UPDATE meta SET &#34;blockedHosts&#34; = &#39;{&#34;&#34;&#34; + blocklist_string + &#34;&#34;&#34;}&#39; WHERE id = &#39;x&#39;&#34;&#34;&#34;

# Execute and error-trap
try:
    # Execute the SQL command
    cursor.execute(table_modification)
    print(&#34;Executed and UPDATED&#34;)

    # Commit the changes to the database
    conn.commit()
    print(&#34;UPDATE Committed&#34;)

    # Create a log file to show that the UPDATE has successfully completed
    open(blocklist_log_path+blocklist_log_filename, &#39;w&#39;)
    print(&#34;UPDATE log file created&#34;)

except:
    # Roll back in case of error
    conn.rollback()
    print(&#34;UPDATE Failed and rolled back&#34;)

# Close the connection
conn.close()
print(&#34;Connection CLOSED&#34;)
</code></pre><h3 id="blocklist_">

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/blocklist_multiple.txt" target="_blank" rel="nofollow noopener noreferrer">blocklist_multiple.txt</a>
</h3>
<p>This is the list of URLs that link to the .csv Blocklist(s):</p>
<pre tabindex="0"><code>https://codeberg.org/oliphant/blocklists/raw/branch/main/blocklists/_unified_tier0_blocklist.csv
https://seirdy.one/pb/pleroma.envs.net.csv
</code></pre><h3 id="personal_">

<a href="https://github.com/BoffinsBlog/Iceshrimp/blob/main/update_iceshrimp_blocklist/personal_blocklist.csv" target="_blank" rel="nofollow noopener noreferrer">personal_blocklist.csv</a>
</h3>
<p>Additionally, a ‘personal_blocklist’ can be created (this file can be named what you like as long as it is a .csv file).</p>
<pre tabindex="0"><code>domain
naughty_fedi.com
</code></pre><h2 id="updating-the-iceshrimp-blocklist-crontab">Updating the Iceshrimp Blocklist crontab<a hidden class="anchor" aria-hidden="true" href="#updating-the-iceshrimp-blocklist-crontab">#</a></h2>
<p>In addition to running the script manually, either script can be executed nightly, at midnight, from a normal crontab (<code>crontab -e</code> from a Terminal).</p>
<pre tabindex="0"><code># Update the iceshrimp blocklist daily at midnight
#0 0 * * * python3 /home/foo/path/to/script/update_blocklist_single.py
0 0 * * * python3 /home/foo/path/to/script/update_blocklist_multiple.py
#
</code></pre><h2 id="finally">Finally<a hidden class="anchor" aria-hidden="true" href="#finally">#</a></h2>
<p>(I did mention this in a 


  <a href="/posts/calckey-fediverse-server/">prior post</a>
 but it bears repeating.)</p>
<p>For anyone interested in getting into the SQL side, pgAdmin is a useful tool.</p>
<p>I installed it using:</p>
<p><code>curl -fsS https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo gpg --dearmor -o /usr/share/keyrings/packages-pgadmin-org.gpg</code></p>
<p><code>sudo sh -c 'echo &quot;deb [signed-by=/usr/share/keyrings/packages-pgadmin-org.gpg] https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/jammy pgadmin4 main&quot; &gt; /etc/apt/sources.list.d/pgadmin4.list &amp;&amp; apt update'</code></p>
<p><code>sudo apt update</code></p>
<p><code>sudo apt install pgadmin4</code></p>
<p><img alt="A screenshot of the Linux application pgAdmin, used to administer PostgreSQL databases. The Calckey Fediverse Server uses PostgreSQL as its back end database engine." loading="lazy" src="/posts/updating-the-iceshrimp-blocklist/01_pgAdmin_Screenshot.webp#center" title="A screenshot of the Linux application pgAdmin, used to administer PostgreSQL databases. The Calckey Fediverse Server uses PostgreSQL as its back end database engine.">
<em>pgAdmin Screenshot</em></p>
<p>However you Fediverse, Enjoy!</p>
<h2 id="update">UPDATE<a hidden class="anchor" aria-hidden="true" href="#update">#</a></h2>
<p>Iceshrimp is moving to a .NET framework.</p>
<p>Additional scripts for updating a blocklist when running Iceshrimp.NET can be found 

<a href="https://github.com/BoffinsBlog/Iceshrimp-NET/tree/main/update_iceshrimp_net_blocklist/" target="_blank" rel="nofollow noopener noreferrer">at</a>
.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://boffinsblog.github.io/tags/fediverse/">Fediverse</a></li>
      <li><a href="https://boffinsblog.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://boffinsblog.github.io/tags/python/">Python</a></li>
      <li><a href="https://boffinsblog.github.io/tags/raspberry-pi/">Raspberry Pi</a></li>
      <li><a href="https://boffinsblog.github.io/tags/self-hosting/">Self Hosting</a></li>
      <li><a href="https://boffinsblog.github.io/tags/web-servers/">Web-Servers</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://boffinsblog.github.io/posts/logging-the-broadband-outages/">
    <span class="title">« Prev</span>
    <br>
    <span>Logging the Broadband Outages</span>
  </a>
  <a class="next" href="https://boffinsblog.github.io/posts/how-to-unbrick-a-sheevaplug/">
    <span class="title">Next »</span>
    <br>
    <span>How to Unbrick a SheevaPlug</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://boffinsblog.github.io/">Boffins Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
        <br>
        <p><a href="https://www.creativecommons.org/licenses/by-nc/4.0/deed.en" rel="noopener noreferrer" target="_blank">This work is licensed under CC BY-NC-SA 4.0</a></p>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
